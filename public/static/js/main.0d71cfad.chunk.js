(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],Array(33).concat([function(e,t,n){},,,function(e,t,n){e.exports=n.p+"static/media/default-image.8b77a166.png"},function(e,t,n){e.exports=n(75)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(22),o=n.n(s),c=(n(42),n(43),n(44),n(5)),l=n(7),i=n(2),u=n(10),m=n(3),d=n(4),p=r.a.createContext(),f=p.Provider,v=p.Consumer,h=function(){return function(e){return function(t){return r.a.createElement(v,null,(function(n){return r.a.createElement(e,Object.assign({},t,{storytellerService:n}))}))}}},E=n(17),b={login:function(e){return{type:"login",payload:e}},setFirstStoryGenresList:function(e){return{type:"setFirstStoryGenresList",payload:e}},loadGenres:function(e){return{type:"loadGenres",payload:e}},addErrorMessage:function(e,t){return{type:"addErrorMessage",payload:{message:e,time:t}}},updateUserData:function(e){return{type:"updateUserData",payload:e}},removeFirstStoryGenresList:function(){return{type:"removeFirstStoryGenresList"}},setNextRoute:function(e){return{type:"setNextRoute",payload:e}},addErrorBanner:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black";return{type:"addErrorBanner",payload:{message:e,delayTime:t,style:n}}},removeErrorBanner:function(e){return{type:"removeErrorBanner",payload:e}}},g=(n(49),n(6)),y=(n(50),n(51),function(e){var t=e.text,n=e.linkTo,a=e.onClick,s=e.className,o=e.style,c=void 0===o?{}:o;return r.a.createElement(l.b,{to:n,className:s,style:c},r.a.createElement("button",{onClick:a},r.a.createElement("span",null,t)))}),w=n(15),k=(n(53),n(19)),N=n.n(k),S=(n(55),function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).input=null,e.componentDidMount=function(){e.props.disabledAutoFocus||e.input.el.current.focus()},e.handlePaste=function(t){var n=e.props.onPaste;if(t.preventDefault(),n)n(t);else{var a=t.clipboardData.getData("Text");document.execCommand("insertText",!1,a)}},e.render=function(){var t=e.props,n=t.value,a=void 0===n?"":n,s=t.disabled,o=void 0!==s&&s,c=t.className,l=void 0===c?"":c,i=t.placeholder,u=void 0===i?null:i,m=t.onFocus,d=void 0===m?null:m,p=t.onBlur,f=void 0===p?null:p,v=t.onMouseEnter,h=void 0===v?null:v,E=t.onMouseLeave,b=void 0===E?null:E,g=t.onChange,y=void 0===g?null:g,w=t.tagName,k=void 0===w?"div":w;return r.a.createElement(N.a,{html:a,className:"input-contenteditable ".concat(l),disabled:o,"data-placeholder":u,tagName:k,onChange:y,onBlur:f,onFocus:d,onMouseEnter:h,onMouseLeave:b,onPaste:e.handlePaste,ref:function(t){return e.input=t}})},e}return n}(r.a.Component)),j=n(25),O=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).input=r.a.createRef(),e.state={inputV:"",usedGenres:[],foundedGenres:[]},e.handleChange=function(t){var n=t.target.value;e.setState({inputV:n}),e.createFoundedGenresList(n)},e.createUsedGenresList=function(){var t=e.props,n=t.usedGenres,a=t.removeGenre;return n?n.map((function(e){return r.a.createElement("li",{key:e,onClick:function(){return a(e)},className:"used-genre"},r.a.createElement("span",null,e),r.a.createElement("div",{className:"cross",onClick:function(){return a(e)}}))})):null},e.componentDidUpdate=function(t){var n=t.usedGenres,a=e.props.usedGenres,r=e.state.inputV;n!==a&&0!==r&&e.createFoundedGenresList(r)},e.handleKeyDown=function(t){if("Backspace"===t.key){var n=e.props,a=n.removeLastUsedGenre,r=n.usedGenres,s=e.state.inputV;r.length>0&&""===s&&a()}},e.createFoundedGenresList=function(t){var n=e.props,a=n.genresList,s=n.usedGenres,o=[];if(a.forEach((function(e){var n=e.name;n.toLowerCase().includes(t.toLowerCase())&&""!==t&&o.push(n)})),s.forEach((function(e){o.forEach((function(t,n){t===e&&o.splice(n,1)}))})),o.length>0){var c=e.props.addGenre;e.setState({foundedGenres:o.slice(0,5).map((function(t){return r.a.createElement("li",{key:t,onClick:function(){c(t),e.setState({inputV:"",foundedGenres:[]})},className:"found-genre"},r.a.createElement("div",null,r.a.createElement("span",null,t)))}))})}else e.setState({foundedGenres:[]})},e.handleFocus=function(){var t=Object(j.a)(e).input;t&&t.current.focus()},e.handleMouseDown=function(t){for(var n=t.path,a=!0,r=0;r<n.length-2;r++)if(n[r].classList.contains("genres")){a=!1;break}a&&e.setState({inputV:"",foundedGenres:[]}),document.removeEventListener("mouseup",e.handleMouseDown,!1),document.removeEventListener("keydown",e.handleKeyDown,!1)},e.componentWillUnmount=function(){document.removeEventListener("mouseup",e.handleMouseDown,!1),document.removeEventListener("keydown",e.handleKeyDown,!1)},e.render=function(){var t=e.state,n=t.inputV,a=t.foundedGenres,s=e.createUsedGenresList();return r.a.createElement("div",{className:"genres",onClick:e.handleFocus},r.a.createElement("ul",{className:"used-genres",onClick:e.handleFocus},s,r.a.createElement("li",null,r.a.createElement("input",{value:n,onChange:e.handleChange,placeholder:"\u0414\u043e\u0434\u0430\u0442\u0438 \u0436\u0430\u043d\u0440...",ref:e.input,onFocus:function(){document.addEventListener("keydown",e.handleKeyDown,!1)},onBlur:function(){document.addEventListener("keydown",e.handleKeyDown,!1),document.addEventListener("mouseup",e.handleMouseDown,!1)}}))),r.a.createElement("ul",{className:"founded-genres gnrs ".concat(a.length>0?"active":"disabled")},a))},e}return n}(r.a.Component),C=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={previewTitle:"",previewImage:null,previewBody:"",usedGenres:[],loadDefaultGenre:!0,needDefaultTitleAndBody:!0,btnEnable:!1},e.postStory=function(){var t=e.state,n=t.usedGenres,a=t.previewImage,r=t.previewBody,s=t.previewTitle,o=e.props,c=o.title,l=o.body;o.storytellerService.stories.post(c,l,n,a,r,s).then((function(t){e.props.history.push("/stories/".concat(t))})).catch((function(){}))},e.forLater=function(){var t=e.props,n=t.storytellerService,a=t.title,r=t.body,s=t.addErrorBanner,o=t.history,c=t.userData.username,l=e.state,i=l.previewTitle,u=l.previewBody,m=l.previewImage;n.drafts.save(a,r,i,u,m).then((function(){s("\u0417\u0431\u0435\u0440\u0435\u0436\u0435\u043d\u043e",3),o.push("/authors/".concat(c))})).catch((function(){s("\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0456 \u0432\u0438\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0438, \u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430, \u0441\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u0447\u0435\u0440\u0435\u0437 \u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434",3)}))},e.createTitle=function(t,n){var a=t.target.value;e.setState((function(){return{previewTitle:e.normalizePreviewText(a,n)}}))},e.createBody=function(t,n){var a=t.target.value;e.setState((function(){return{previewBody:e.normalizePreviewText(a,n)}}))},e.onMaxLength=function(e,t){return e.length>t?e.split("").slice(0,t).join(""):e},e.normalizePreviewText=function(t,n){var a=t.split("<br>").join("").split("<div>").join("").split("</div>").join("").replace("&nbsp;"," ").replace("&nbs;","").replace("&amp;","");return e.onMaxLength(a,n)},e.handleImageFieldChange=function(t){var n=e.props.storytellerService;n.image.post(t.target.files[0]).then((function(t){e.setState((function(){return{previewImage:n.image.get(t)}}))})).catch((function(){})),t.target.value=null},e.removeImage=function(){e.setState((function(){return{previewImage:null}}))},e.removeLastUsedGenre=function(){var t=e.state.usedGenres,n=t.slice(0,t.length-1);n.splice(n.length,1),e.setState({usedGenres:n})},e.addGenre=function(t){var n=e.state.usedGenres;-1!==n.findIndex((function(e){return e===t}))?e.removeGenre(t):e.setState({usedGenres:[].concat(Object(w.a)(n),[t])})},e.removeGenre=function(t){e.setState((function(e){var n=e.usedGenres,a=n.findIndex((function(e){return e===t}));if(-1===a)return{usedGenres:n};var r=n.slice(0,n.length);return r.splice(a,1),{usedGenres:r}}))},e.componentDidMount=function(){var t=e.props,n=t.firstStoryGenresList,a=t.removeFirstStoryGenresList;e.setState({usedGenres:n}),a()},e.componentDidUpdate=function(t){var n=t.className,a=e.state,r=a.previewBody,s=a.previewTitle,o=a.btnEnable,c=a.needDefaultTitleAndBody,l=e.props,i=l.title,u=l.body,m=l.className;if(c&&m!==n){var d=i.split("<")[0].split(" ").slice(0,9).join(" "),p=0!==u.length?u[0].value.split("<")[0].split(" ").slice(0,9).join(" "):"";e.setState({needDefaultTitleAndBody:!1,previewTitle:d,previewBody:p})}0!==i.length&&0!==u.length&&0!==r.length&&0!==s.length?o||e.setState({btnEnable:!0}):o&&e.setState({btnEnable:!1})},e.handlePostStrory=function(){e.state.btnEnable?e.postStory():(0,e.props.addErrorBanner)("\u0420\u043e\u0437\u043f\u043e\u0432\u0456\u0434\u044c \u043f\u043e\u0432\u0438\u043d\u043d\u0430 \u043c\u0430\u0441\u0442\u0438\u0442\u0438 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a, \u0442\u0456\u043b\u043e, \u043c\u0456\u043d\u0456-\u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0442\u0430 \u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u043e\u043f\u0438\u0441",6,"white")},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.previewBody,a=t.previewTitle,s=t.previewImage,o=t.usedGenres,c=t.btnEnable,l=this.props,i=l.remove,u=l.genresList,m=l.className;return r.a.createElement("div",{className:"last-story-change "+m},r.a.createElement("div",{className:"background",onClick:function(){return i()}}),r.a.createElement("div",{className:"layout"},r.a.createElement("div",{className:"col preview__container"},r.a.createElement("h3",null,"\u041f\u043e\u043f\u0435\u0440\u0435\u0434\u043d\u0456\u0439 \u043f\u0435\u0440\u0435\u0433\u044f\u0434"),r.a.createElement("div",{className:"preview"},r.a.createElement("div",{className:"preview-image ".concat(s?"with-image":""),style:{backgroundImage:"url(".concat(s,")")}},s?r.a.createElement("div",{className:"cross",onClick:function(){return e.removeImage()}}):null,r.a.createElement("label",null,r.a.createElement("input",{type:"file",accept:".jpg, .jpeg, .png",name:"upload-image",onChange:this.handleImageFieldChange}),"\u0417\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f")),r.a.createElement("div",{className:"title-and-body__preview"},r.a.createElement(S,{tagName:"h3",className:"title",onChange:function(t){return e.createTitle(t,60)},placeholder:"\u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a... (60 \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432)",value:a}),r.a.createElement(S,{tagName:"p",className:"body",onChange:function(t){return e.createBody(t,120)},placeholder:"\u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u043e\u043f\u0438\u0441... (120 \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432)",value:n})))),r.a.createElement("div",{className:"col right-col"},r.a.createElement("h3",{className:"add-genre-h3"},"\u0414\u043e\u0434\u0430\u0439\u0442\u0435 \u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0436\u0430\u043d\u0440\u0456\u0432"),r.a.createElement(O,{removeLastUsedGenre:this.removeLastUsedGenre,usedGenres:o,genresList:u,addGenre:this.addGenre,removeGenre:this.removeGenre}),r.a.createElement("div",{className:"hr"}),r.a.createElement("div",{className:"publish"},r.a.createElement(y,{linkTo:"#",onClick:this.handlePostStrory,className:"blue-btn small-blue-btn ".concat(c?"enabled":"disabled"),text:"\u041e\u043f\u0443\u0431\u043b\u0456\u043a\u0443\u0432\u0430\u0442\u0438"}))),r.a.createElement("div",{className:"close-me",onClick:i},r.a.createElement("div",{className:"cross"}))))}}]),n}(r.a.Component),x=Object(c.b)((function(e){return{genresList:e.genresList,firstStoryGenresList:e.firstStoryGenresList,userData:e.userData}}),b)(h()(Object(E.h)(C))),L=function(){var e=Object(a.useState)(!1),t=Object(g.a)(e,2),n=t[0],s=t[1],o=Object(a.useState)({title:"",body:[]}),c=Object(g.a)(o,2),l=c[0],i=c[1],u=function e(t){"Escape"===t.key&&(document.removeEventListener("keydown",e,!1),s(!1))},m=function(){var e=document.querySelector(".story-editor .title-field").innerHTML,t=Array.prototype.slice.call(document.querySelectorAll(".story-editor .body .stories-block .story-item")).map((function(e){var t={type:"",value:e.innerHTML};return e.classList.contains("text")&&(t.type="text"),e.classList.contains("quote")&&(t.type="quote"),e.classList.contains("img")&&(t.type="img",t.value=e.src),e.classList.contains("distributor")&&(t.type="hr",delete t.value),t}));i({title:e,body:t})};return Object(a.useEffect)((function(){document.title="\u041d\u043e\u0432\u0430 \u0456\u0441\u0442\u043e\u0440\u0456\u044f \u2013 Storyteller"}),[]),Object(a.useEffect)((function(){return document.body.style.overflowY=n?"hidden":"auto",function(){document.body.style.overflowY="auto"}}),[n]),r.a.createElement(r.a.Fragment,null,r.a.createElement(y,{className:"blue-btn minimize a",linkTo:"#",text:"\u041e\u043f\u0443\u0431\u043b\u0456\u043a\u0443\u0432\u0430\u0442\u0438",onClick:function(){s(!0),m(),document.removeEventListener("keydown",u,!1),document.addEventListener("keydown",u,!1)}}),r.a.createElement(x,{className:n?"":"hidden",remove:function(){return s(!1)},title:l.title,body:l.body}))},T=function(e){var t=e.urlToImage,n=e.className,a=e.userId;return r.a.createElement(y,{linkTo:"/authors/".concat(a),className:"".concat(n," ").concat(t?"":"default"),style:t?{backgroundImage:"url(".concat(t,")")}:{}})},D=(n(56),Object(c.b)((function(){return{}}),b)(Object(E.h)(h()((function(e){var t=e.visible,n=e.hideMe,s=e.history,o=e.login,c=e.storytellerService;Object(a.useEffect)((function(){document.body.style.overflowY=t?"hidden":"auto"}),[t]);var l=function(e){n(),s.push("/settings".concat(e))};return r.a.createElement("div",{className:"settings-panel-container ".concat(t?"":"hide")},r.a.createElement("div",{className:"background",onClick:n}),r.a.createElement("div",{className:"settings-panel-inner"},r.a.createElement("button",{onClick:function(){return l("/profile")}},"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u043f\u0440\u043e\u0444\u0456\u043b\u044c"),r.a.createElement("button",{onClick:function(){return l("/password")}},"\u0417\u043c\u0456\u043d\u0438\u0442\u0438 \u043f\u0430\u0440\u043e\u043b\u044c"),r.a.createElement("button",{onClick:function(){return l("/stories")}},"\u0406\u0441\u0442\u043e\u0440\u0456\u0457"),r.a.createElement("button",{onClick:function(){return l("/followings")}},"\u0421\u0442\u0435\u0436\u0443 \u0437\u0430..."),r.a.createElement("button",{className:"logout",onClick:function(){o(!0),n(),c.logout()}},"\u0412\u0438\u0439\u0442\u0438"),r.a.createElement("button",{onClick:n},"\u0421\u043a\u0430\u0441\u0443\u0432\u0430\u0442\u0438")))}))))),F=Object(c.b)((function(e){return{needLogin:e.needLogin,userData:e.userData}}),(function(){return{}}))((function(e){var t=e.needLogin,n=e.userData,s=n.username,o=n.urlToImage,c=Object(a.useState)(!1),i=Object(g.a)(c,2),u=i[0],m=i[1],d=Object(a.useState)(!1),p=Object(g.a)(d,2),f=p[0],v=p[1];return Object(a.useEffect)((function(){document.documentElement.classList.contains("mobile")&&m(!0)}),[]),t?r.a.createElement("div",{className:"user-panel"},r.a.createElement(E.d,null,r.a.createElement(E.b,{path:"/about"},r.a.createElement(y,{text:"\u0420\u043e\u0437\u043f\u043e\u0432\u0456\u0441\u0442\u0438",linkTo:"/registration",className:"blue-btn"})),r.a.createElement(E.b,{path:"/registration"}),r.a.createElement(E.b,{path:"/login"}),r.a.createElement(E.b,{path:"/"},r.a.createElement(l.b,{to:"/login"},"\u0423\u0432\u0456\u0439\u0442\u0438"),r.a.createElement(y,{text:"\u0417\u0430\u0440\u0435\u0454\u0441\u0442\u0440\u0443\u0432\u0430\u0442\u0438\u0441\u044f",linkTo:"/registration",className:"blue-btn"})))):r.a.createElement("div",{className:"user-panel"},r.a.createElement(D,{visible:f,hideMe:function(){v(!1)}}),r.a.createElement(E.d,null,r.a.createElement(E.b,{path:"/write-story"},r.a.createElement(L,null)),r.a.createElement(E.b,{path:"/settings"},r.a.createElement(y,{className:"blue-btn minimize a",linkTo:"/write-story",text:"\u0414\u043e\u0434\u0430\u0442\u0438 \u0440\u043e\u0437\u043f\u043e\u0432\u0456\u0434\u044c"})),r.a.createElement(E.b,{path:"/"},u?r.a.createElement(y,{className:"setting up-item a",linkTo:"/settings/profile"}):r.a.createElement("div",{className:"setting up-item a",onClick:function(){return v(!0)}},r.a.createElement("button",null,r.a.createElement("span",null))),r.a.createElement(y,{className:"blue-btn minimize a",linkTo:"/write-story",text:"\u0414\u043e\u0434\u0430\u0442\u0438 \u0440\u043e\u0437\u043f\u043e\u0432\u0456\u0434\u044c"}))),r.a.createElement(T,{urlToImage:o,className:"user-avatar up-item",userId:s}))})),I=function(){return r.a.createElement("header",null,r.a.createElement("div",{className:"top"},r.a.createElement("div",{className:"left"},r.a.createElement(l.b,{to:"/"},r.a.createElement("div",{className:"storyteller-logo"}))),r.a.createElement("div",{className:"right"},r.a.createElement(F,null))))},B=(n(57),function(){return r.a.createElement("footer",null,r.a.createElement("div",{className:"left"},r.a.createElement(l.b,{to:"/"},r.a.createElement("div",{className:"storyteller-logo"})),r.a.createElement("span",{className:"copyright"},"\xa9 2020, Storyteller")),r.a.createElement("div",{className:"right"},r.a.createElement("li",null,r.a.createElement(l.b,{to:"/stories"},r.a.createElement("span",null,"\u0420\u043e\u0437\u043f\u043e\u0432\u0456\u0434\u0456"))),r.a.createElement("li",null,r.a.createElement(l.b,{to:"/authors"},r.a.createElement("span",null,"\u0410\u0432\u0442\u043e\u0440\u0438"))),r.a.createElement("li",null,r.a.createElement(l.b,{to:"/about"},r.a.createElement("span",null,"\u041f\u0440\u043e Storyteller")))))}),M=(n(58),Object(c.b)((function(){return{}}),b)((function(e){var t=e.setNextRoute;return r.a.createElement(y,{text:"\u041f\u043e\u0447\u0430\u0442\u0438 \u0440\u043e\u0437\u043f\u043e\u0432\u0456\u0434\u044c",linkTo:"/write-story",className:"blue-btn",onClick:function(){t("/write-story")}})}))),_=Object(c.b)((function(){return{}}),b)((function(e){var t=e.text,n=(e.id,e.setFirstStoryGenresList),s=Object(a.useState)(!1),o=Object(g.a)(s,2),c=o[0],l=o[1];return r.a.createElement("button",{className:c?"active":"",onClick:function(){n(t),l(!c)}},r.a.createElement("span",null,t))})),A=Object(c.b)((function(e){return{genresList:e.genresList}}),b)((function(e){var t=e.genresList,n=Object(a.useState)([]),s=Object(g.a)(n,2),o=s[0],c=s[1];return Object(a.useEffect)((function(){c(t.map((function(e){var t=e._id,n=e.name;return r.a.createElement(_,{text:n,key:t,id:t})})))}),[t]),r.a.createElement("div",{className:"genres"},r.a.createElement("h1",null,"\u041d\u0435 \u0431\u0456\u0439\u0441\u044f \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0438 \u0442\u0430\u043b\u0430\u043d\u0442 ",r.a.createElement("br",null)," \u0443\u0441\u044c\u043e\u043c\u0443 \u0441\u0432\u0456\u0442\u043e\u0432\u0456!"),r.a.createElement("div",{className:"genres-list"},o),r.a.createElement("h3",null,"\u0412 \u044f\u043a\u0438\u0445 \u0436\u0430\u043d\u0440\u0430\u0445 \u0442\u0438 \u0440\u043e\u0437\u043f\u043e\u0447\u043d\u0435\u0448 \u043c\u0430\u0439\u0431\u0443\u0442\u043d\u044e \u0440\u043e\u0437\u043f\u043e\u0432\u0456\u0434\u044c?"),r.a.createElement(M,null))})),U=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).componentDidMount=function(){document.title="\u041b\u0430\u0441\u043a\u0430\u0432\u043e \u043f\u0440\u043e\u0441\u0438\u043c\u043e \u0434\u043e Storyteller"},e}return Object(u.a)(n,[{key:"render",value:function(){return r.a.createElement("div",{className:"about"},r.a.createElement(A,null),r.a.createElement("div",{className:"main"},r.a.createElement("section",{className:"your-story"},r.a.createElement("div",{className:"text"},r.a.createElement("h2",null,"\u041d\u0430\u043f\u0438\u0448\u0438",r.a.createElement("br",null),"\u0441\u0432\u043e\u044e \u0456\u0441\u0442\u043e\u0440\u0456\u044e!"),r.a.createElement("p",null,"\u0425\u043e\u0447\u0435\u0448 \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u0438 \u043a\u043d\u0438\u0433\u0443 \u0430\u0431\u043e \u043a\u043e\u0440\u043e\u0442\u043a\u0435 \u043e\u043f\u043e\u0432\u0456\u0434\u0430\u043d\u043d\u044f? \u0410 \u043c\u043e\u0436\u0435 \u0442\u0438 \u043f\u043e\u0435\u0442 \u0430\u0431\u043e \u043f\u043e\u0435\u0442\u0435\u0441\u0430?",r.a.createElement("span",null," \u041f\u0430\u043c\u2019\u044f\u0442\u0430\u0439! \u0423 \u043a\u043e\u0436\u043d\u043e\u0433\u043e \u0454 \u0456\u0441\u0442\u043e\u0440\u0456\u044f, \u044f\u043a\u043e\u044e \u0432\u0456\u043d \u0445\u043e\u0442\u0456\u0432 \u0431\u0438 \u043f\u043e\u0434\u0456\u043b\u0438\u0442\u0438\u0441\u044f!")))),r.a.createElement("section",{className:"reverse chapter"},r.a.createElement("div",{className:"text"},r.a.createElement("h2",null,"\u041f\u0438\u0448\u0438 \u0433\u043b\u0430\u0432\u0443 ",r.a.createElement("br",null)," \u0437\u0430 \u0433\u043b\u0430\u0432\u043e\u044e."),r.a.createElement("p",null,"\u041d\u0430\u0432\u0456\u0442\u044c \u044f\u043a\u0449\u043e \u0442\u0432\u043e\u044f \u0440\u043e\u0437\u043f\u043e\u0432\u0456\u0434\u044c \u0449\u0435 \u043d\u0435 \u0437\u0430\u043a\u0456\u043d\u0447\u0435\u043d\u0430, \u0442\u0438 \u043c\u043e\u0436\u0435\u0448 \u043f\u0443\u0431\u043b\u0456\u043a\u0443\u0432\u0430\u0442\u0438 \u0457\u0457 \u043f\u043e\u0441\u0442\u0443\u043f\u043e\u0432\u043e, \u0433\u043b\u0430\u0432\u0443 \u0437\u0430 \u0433\u043b\u0430\u0432\u0443\u044e. ",r.a.createElement("span",null,"\u0422\u0432\u043e\u0457 \u043f\u0456\u0434\u043f\u0438\u0441\u043d\u0438\u043a\u0438 \u0431\u0443\u0434\u0443\u0442\u044c \u0437 \u043d\u0435\u0442\u0435\u0440\u043f\u0456\u043d\u043d\u044f\u043c \u0447\u0435\u043a\u0430\u0442\u0438 \u043d\u043e\u0432\u0438\u0445 \u043e\u043d\u043e\u0432\u043b\u0435\u043d\u044c.")))),r.a.createElement("section",{className:"feedback"},r.a.createElement("div",{className:"text"},r.a.createElement("h2",null,"\u041e\u0442\u0440\u0438\u043c\u0443\u0439 \u201c\u0444\u0456\u0434\u0431\u0435\u043a\u201d."),r.a.createElement("p",null,"\u041f\u0438\u0448\u0438 \u0440\u043e\u0437\u043f\u043e\u0432\u0456\u0434\u0456, \u043a\u043d\u0438\u0433\u0438 \u0430\u0431\u043e \u0432\u0456\u0440\u0448\u0456, \u043e\u0442\u0440\u0438\u043c\u0443\u0439 \u043b\u0430\u0439\u043a\u0438, \u043a\u043e\u043c\u0435\u043d\u0442\u0430\u0440\u0456 \u0456 \u0431\u0435\u0437\u043f\u043e\u0441\u0435\u0440\u0435\u0434\u043d\u044c\u043e \u0441\u043f\u0456\u043b\u043a\u0443\u0439\u0441\u044f \u0437 \u0448\u0430\u043d\u0443\u0432\u0430\u043b\u044c\u043d\u0438\u043a\u0430\u043c\u0438 \u0441\u0432\u043e\u0433\u043e \u0442\u0430\u043b\u0430\u043d\u0442\u0443. \u0425\u043e\u0447\u0435\u0448 \u0437\u0430\u0440\u043e\u0431\u043b\u044f\u0442\u0438 \u043d\u0430 \u0446\u044c\u043e\u043c\u0443? \u041b\u0435\u0433\u043a\u043e!",r.a.createElement("span",null," \u041f\u0456\u0434\u043f\u0438\u0441\u043d\u0438\u043a\u0438 \u043c\u0430\u044e\u0442\u044c \u0437\u043c\u043e\u0433\u0443 \u043c\u0430\u0442\u0435\u0440\u0456\u0430\u043b\u044c\u043d\u043e \u043f\u0456\u0434\u0442\u0440\u0438\u043c\u0443\u0432\u0430\u0442\u0438 \u0443\u043b\u044e\u0431\u043b\u0435\u043d\u0438\u0445 \u0430\u0432\u0442\u043e\u0440\u0456\u0432."))))),r.a.createElement("div",{className:"bottom"},r.a.createElement("h2",null,"\u0420\u043e\u0437\u043a\u0440\u0438\u0439 \u0441\u0432\u0456\u0439 \u0442\u0430\u043b\u0430\u043d\u0442.",r.a.createElement("br",null),"\u041f\u043e\u043a\u0430\u0436\u0438 \u0441\u0432\u043e\u0457 \u0434\u0443\u043c\u043a\u0438."),r.a.createElement(M,null)))}}]),n}(r.a.Component),G=(n(59),function(){return function(e){return Object(c.b)((function(e){return{nextRoute:e.nextRoute}}),b)(Object(E.h)(h()((function(t){return r.a.createElement("div",{className:"auth"},r.a.createElement("div",{className:"left"}),r.a.createElement("div",{className:"right"},r.a.createElement(e,t)))}))))}}),R=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).state={loginButtonEnable:!1,username:"",password:"",email:"",usernameTimer:null,trueUser:!1,trueEmail:!1},e.handleLogin=function(){var t=e.props,n=t.storytellerService,a=t.login,r=t.updateUserData,s=e.state,o=s.username,c=s.password,l=s.email;n.reg(o,l,c).then((function(e){a(!1);var t=e.username,n=e.name,s=e.surname,o=e.urlToImage,c=e._id;r({userId:c,username:t,name:n,urlToImage:o,surname:s})})).catch((function(t){a(!0),(0,e.props.addErrorBanner)("\u041f\u0435\u0440\u0435\u0432\u0456\u0440\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u0456\u0441\u0442\u044c \u0432\u0432\u0435\u0434\u0435\u043d\u0438\u0445 \u0434\u0430\u043d\u043d\u0438\u0445",3)}))},e.username=function(t){var n=t.target.value;e.setState({username:e.correctUsername(n)})},e.email=function(t){var n=t.target.value;return e.setState({email:e.correctEmail(n)})},e.password=function(t){var n=t.target.value,a=e.convertPassword(e.disableSpaceAndEnter(n));e.setState({password:a})},e.correctUsername=function(t){var n=e.props,a=n.addErrorBanner,r=n.storytellerService,s=e.maxLength(e.disableSpaceAndEnter(t),16);return r.checkUsername(s).then((function(n){var r=function(){var t=e.state.usernameTimer;clearTimeout(t)},s=function(t,n){r(),e.setState({usernameTimer:setTimeout((function(){a(t,n,"white")}),500),trueUser:!1})};if(0!==t.length)switch(n){case"busy":s("\u0414\u0430\u043d\u0438\u0439 \u043d\u0456\u043a\u043d\u0435\u0439\u043c \u0432\u0436\u0435 \u043a\u0438\u043c\u043e\u0441\u044c \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u044c\u0441\u044f",3);break;case"incorrect":s('\u0414\u043e\u0432\u0436\u0438\u043d\u0430 \u043d\u0456\u043a\u043d\u0435\u0439\u043c\u0430 \u0432\u0456\u0434 4 \u0434\u043e 16 \u0441\u0438\u043c\u043e\u043b\u0456\u0432. \u041c\u043e\u0436\u043d\u0430 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u043b\u0430\u0442\u0438\u043d\u0441\u044c\u043a\u0456 \u043b\u0456\u0442\u0435\u0440\u0438, \u0446\u0438\u0444\u0440\u0438 \u0442\u0430 \u043d\u0438\u0436\u043d\u0456 \u043f\u0456\u0434\u043a\u0440\u0435\u0441\u043b\u0435\u043d\u043d\u044f "_"',3);break;default:r(),e.setState({trueUser:!0})}})).catch((function(){a("\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0456 \u0432\u0438\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0438, \u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430, \u0437\u0430\u0447\u0435\u043a\u0430\u0439\u0442\u0435",3,"white")})),s},e.correctEmail=function(t){var n=e.props,a=n.addErrorBanner,r=n.storytellerService,s=e.disableSpaceAndEnter(t);return r.checkEmail(s).then((function(n){var r=function(){var t=e.state.usernameTimer;clearTimeout(t)},s=function(t,n){r(),e.setState({usernameTimer:setTimeout((function(){a(t,n,"white")}),2500),trueEmail:!1})};if(0!==t.length)switch(n){case"busy":s("\u0414\u0430\u043d\u0438\u0439 \u0435\u043c\u0435\u0439\u043b \u0432\u0436\u0435 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u044c\u0441\u044f",3);break;case"incorrect":s("\u0412\u0432\u0435\u0434\u0456\u0442\u044c \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u0438\u0439 \u0435\u043c\u0435\u0439\u043b",3);break;default:r(),e.setState({trueEmail:!0})}})).catch((function(){a("\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0456 \u0432\u0438\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0438, \u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430, \u0437\u0430\u0447\u0435\u043a\u0430\u0439\u0442\u0435",3,"white")})),s},e.maxLength=function(t,n){return t.length>n?((0,e.props.addErrorBanner)("\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430 \u0434\u043e\u0432\u0436\u0438\u043d\u0430 \u043d\u0456\u043a\u043d\u0435\u0439\u043c\u0430 16 \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",5,"white"),t.slice(0,n)):t},e.disableSpaceAndEnter=function(e){var t=e;return["<br>","<div>","</div>","</br>"].forEach((function(e){t=t.split(e).join("")})),t.replace("&nbsp;"," ").replace("&nbsp;","")},e.convertPassword=function(t){var n=e.state.password,a=t.length;return a>n.length?n+t.slice(a-1,a):n.slice(0,a)},e.componentDidUpdate=function(){var t=e.state,n=t.trueUser,a=t.password,r=t.loginButtonEnable;t.trueEmail&&n&&a?r||e.setState({loginButtonEnable:!0}):r&&e.setState({loginButtonEnable:!1})},e.componentDidMount=function(){document.title="\u0420\u0435\u0454\u0441\u0442\u0440\u0430\u0446\u0456\u044f \u2013 Storyteller",document.addEventListener("keydown",e.onKeyDown,!1)},e.componentWillUnmount=function(){document.removeEventListener("keydown",e.onKeyDown,!1)},e.onKeyDown=function(t){"Enter"===t.key&&e.EnterLogin()},e.EnterLogin=function(){var t=e.state.loginButtonEnable,n=e.props.addErrorBanner;t?e.handleLogin():n("\u041f\u0435\u0440\u0435\u0432\u0456\u0440\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u0456\u0441\u0442\u044c \u0432\u0432\u0435\u0434\u0435\u043d\u0438\u0445 \u0434\u0430\u043d\u043d\u0438\u0445",3,"white")},e.createPasswordDots=function(e){var t=e.length;return"\u2022".repeat(t)},e.render=function(){var t=e.state,n=t.loginButtonEnable,a=t.username,s=t.email,o=t.password,c=e.createPasswordDots(o);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"p"},"\u0412\u0441\u0456\u043c \u043f\u0440\u0438\u0432\u0456\u0442! \u0417\u0432\u0435\u0440\u0442\u0430\u0439\u0442\u0435\u0441\u044c \u0434\u043e \u043c\u0435\u043d\u0435, \u044f\u043a\xa0",r.a.createElement(S,{placeholder:"\u0432\u0432\u0435\u0434\u0456\u0442\u044c \u043d\u0456\u043a",value:a,onChange:e.username,className:"input",disabledAutoFocus:!0}),".\xa0\u041e\u0434\u043d\u043e\u0433\u043e \u0434\u043d\u044f \u044f \u043e\u0442\u0440\u0438\u043c\u0430\u0432 \u043b\u0438\u0441\u0442 \u043d\u0430\xa0",r.a.createElement(S,{placeholder:"\u0435\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0443 \u043f\u043e\u0448\u0442\u0443",value:s,onChange:e.email,className:"input",disabledAutoFocus:!0}),"\xa0\u0437\xa0",r.a.createElement(S,{placeholder:"\u043f\u0430\u0440\u043e\u043b\u0435\u043c",value:c,onChange:e.password,className:"input",disabledAutoFocus:!0}),". \u042f \u0440\u043e\u0437\u043a\u0430\u0436\u0443 \u044f\u043a..."),r.a.createElement("div",{className:"bottom"},r.a.createElement(y,{linkTo:"#",text:"\u041f\u0440\u043e\u0434\u043e\u0432\u0436\u0438\u0442\u0438",className:"blue-btn ".concat(n?"":"disabled"),onClick:e.handleLogin}),r.a.createElement(l.b,{to:"/login"},"\u042f \u0432\u0436\u0435 \u043f\u0438\u0441\u0430\u0432 \u0456\u0441\u0442\u043e\u0440\u0456\u0457 \u0442\u0443\u0442")))},e}return n}(r.a.Component),q=G()(R),P=n(11),Y=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).state={loginButtonEnable:!1,username:"",password:"",usernameTimer:null,trueUser:!1},e.handleLogin=function(){var t=e.props,n=t.storytellerService,a=t.login,r=t.updateUserData,s=t.history,o=t.nextRoute,c=e.state,l=c.username,i=c.password;n.login(l,i).then((function(e){a(!1);var t=e._id;r(Object(P.a)({},e,{userId:t})),o&&s.push(o)})).catch((function(){a(!0);var t=e.props.addErrorBanner;e.setState({password:""}),t("\u041f\u0435\u0440\u0435\u0432\u0456\u0440\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u0456\u0441\u0442\u044c \u0432\u0432\u0435\u0434\u0435\u043d\u0438\u0445 \u0434\u0430\u043d\u043d\u0438\u0445",3,"white")}))},e.username=function(t){var n=t.target.value;e.setState({username:e.correctUsername(n)})},e.email=function(t){var n=t.target.value;return e.setState({email:e.correctEmail(n)})},e.password=function(t){var n=t.target.value;e.setState({password:e.convertPassword(e.disableSpaceAndEnter(n))})},e.correctUsername=function(t){var n=e.props,a=n.addErrorBanner,r=n.storytellerService,s=e.maxLength(e.disableSpaceAndEnter(t),16);return r.checkUsername(s).then((function(n){var r,s,o=function(){var t=e.state.usernameTimer;clearTimeout(t)};if(0!==t.length)switch(n){case"incorrect":r='\u0414\u043e\u0432\u0436\u0438\u043d\u0430 \u043d\u0456\u043a\u043d\u0435\u0439\u043c\u0430 \u0432\u0456\u0434 4 \u0434\u043e 16 \u0441\u0438\u043c\u043e\u043b\u0456\u0432. \u041c\u043e\u0436\u043d\u0430 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u043b\u0430\u0442\u0438\u043d\u0441\u044c\u043a\u0456 \u043b\u0456\u0442\u0435\u0440\u0438, \u0446\u0438\u0444\u0440\u0438 \u0442\u0430 \u043d\u0438\u0436\u043d\u0456 \u043f\u0456\u0434\u043a\u0440\u0435\u0441\u043b\u0435\u043d\u043d\u044f "_"',s=3,o(),e.setState({usernameTimer:setTimeout((function(){a(r,s,"white")}),1e3),trueUser:!1});break;default:o(),e.setState({trueUser:!0})}})).catch((function(){a("\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0456 \u0432\u0438\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0438, \u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430, \u0437\u0430\u0447\u0435\u043a\u0430\u0439\u0442\u0435",3,"white")})),s},e.maxLength=function(t,n){return t.length>n?((0,e.props.addErrorBanner)("\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430 \u0434\u043e\u0432\u0436\u0438\u043d\u0430 \u043d\u0456\u043a\u043d\u0435\u0439\u043c\u0430 16 \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",5,"white"),t.slice(0,n)):t},e.disableSpaceAndEnter=function(e){var t=e;return["<br>","<div>","</div>","</br>"].forEach((function(e){t=t.split(e).join("")})),t.replace("&nbsp;"," ").replace("&nbsp;","")},e.convertPassword=function(t){var n=e.state.password,a=t.length;return a>n.length?n+t.slice(a-1,a):n.slice(0,a)},e.createPasswordDots=function(e){var t=e.length;return"\u2022".repeat(t)},e.componentDidUpdate=function(){var t=e.state,n=t.trueUser,a=t.password,r=t.loginButtonEnable;n&&a?r||e.setState({loginButtonEnable:!0}):r&&e.setState({loginButtonEnable:!1})},e.componentDidMount=function(){document.title="\u0412\u0445\u0456\u0434 \u2013 Storyteller",document.addEventListener("keydown",e.onKeyDown,!1)},e.componentWillUnmount=function(){document.removeEventListener("keydown",e.onKeyDown,!1)},e.onKeyDown=function(t){"Enter"===t.key&&e.EnterLogin()},e.EnterLogin=function(){var t=e.state.loginButtonEnable,n=e.props.addErrorBanner;t?e.handleLogin():n("\u041f\u0435\u0440\u0435\u0432\u0456\u0440\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u0456\u0441\u0442\u044c \u0432\u0432\u0435\u0434\u0435\u043d\u0438\u0445 \u0434\u0430\u043d\u043d\u0438\u0445",3,"white")},e.render=function(){var t=e.state,n=t.loginButtonEnable,a=t.password,s=t.username,o=e.props.nextRoute,c=e.createPasswordDots(a);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"p"},"\u041f\u0440\u0438\u0432\u0456\u0442! \u041c\u0435\u043d\u0435 \u0437\u0432\u0430\u0442\u0438\xa0",r.a.createElement(S,{placeholder:"\u0432\u0432\u0435\u0434\u0456\u0442\u044c \u043d\u0456\u043a",value:s,onChange:e.username,className:"input",disabledAutoFocus:!0}),"\xa0\u041d\u0430\u0434\u0456\u044e\u0441\u044c \u043c\u0456\u0439\xa0",r.a.createElement(S,{placeholder:"\u043f\u0430\u0440\u043e\u043b\u044c",value:c,onChange:e.password,className:"input",disabledAutoFocus:!0}),"\xa0\u043d\u0435 \u0437\u0430\u0433\u0443\u0431\u0438\u0432\u0441\u044f. \u0421\u044c\u043e\u0433\u043e\u0434\u043d\u0456 \u044f \u043f\u0440\u043e\u0434\u043e\u0432\u0436\u0443 \u043f\u0438\u0441\u0430\u0442\u0438 \u043f\u0440\u043e \u0442\u0435 \u044f\u043a..."),r.a.createElement("div",{className:"bottom"},r.a.createElement(y,{linkTo:o||"#",text:"\u041f\u0440\u043e\u0434\u043e\u0432\u0436\u0438\u0442\u0438",className:"blue-btn ".concat(n?"":"disabled"),onClick:e.handleLogin}),r.a.createElement(l.b,{to:"/registration"},"\u042f \u0449\u0435 \u043d\u0435 \u043f\u0438\u0441\u0430\u0432 \u0456\u0441\u0442\u043e\u0440\u0456\u0439 \u0442\u0443\u0442")))},e}return n}(r.a.Component),K=G()(Y),H=(n(60),function(){var e=Object(a.useState)(""),t=Object(g.a)(e,2),n=t[0],s=t[1];return r.a.createElement(S,{tagName:"h3",placeholder:"\u041d\u0430\u0437\u0432\u0430 \u0442\u0432\u043e\u0454\u0457 \u0456\u0441\u0442\u043e\u0440\u0456\u0457!",value:n,className:"title-field se-item",onChange:function(e){var t=e.target.value;return s(t)}})}),z=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).storiesBlock=null,e.state={mobility:!1,width:"100%",posY:0,posX:0},e.onMouseDown=function(t){var n=e.storiesBlock.getBoundingClientRect(),a=t.target.getBoundingClientRect();document.body.style.overflowY="hidden",e.setState({mobility:!0,width:n.width,posY:a.y,posX:a.x}),document.addEventListener("mousemove",e.mouseMove,!1)},e.onMouseUp=function(t){if(e.state.mobility){document.body.style.overflowY="auto";var n,a,r,s=e.props.moveField;a=Array.prototype.slice.call(document.querySelectorAll(".body .stories-block")).map((function(e,t){var a=e.getBoundingClientRect().y;return e.classList.contains("mobile")&&(n=t,r=a),a})).sort((function(e,t){return e-t})).findIndex((function(e){return e===r})),s(n,a),e.setState({mobility:!1}),document.removeEventListener("mousemove",e.mouseMove,!1)}},e.mouseMove=function(t){return e.setState({posY:t.clientY,posX:t.clientX})},e.render=function(){var t=e.props,n=t.children,a=t.className,s=void 0===a?"":a,o=t.onMouseEnter,c=t.onMouseLeave,l=t.id,i=t.deleteField,u=e.state,m=u.mobility,d=u.width,p=u.posY,f=u.posX;return r.a.createElement("div",{className:"stories-block ".concat(s," ").concat(m?"mobile":""),onMouseEnter:o,onMouseLeave:c,onMouseUp:e.onMouseUp,onTouchEnd:e.onMouseUp,style:{width:m?d:"100%",top:m?p-16:"auto",left:m?f-d+48:"auto"},ref:function(t){return e.storiesBlock=t}},n,r.a.createElement("div",{className:"menu"},r.a.createElement("button",{className:"move menu-item",onMouseDown:e.onMouseDown}),r.a.createElement("button",{className:"basket menu-item",onClick:function(){return i(l)}})))},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("mouseup",this.onMouseUp,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mouseup",this.onMouseUp,!1),document.removeEventListener("mousedown",this.onMouseDown,!1),document.removeEventListener("mousemove",this.mouseMove,!1)}}]),n}(r.a.Component),X=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).state={value:"",onFocus:!1,onHover:!1,showMenu:!1},e.componentDidUpdate=function(){var t=e.state,n=t.onFocus,a=t.onHover,r=t.showMenu;n||!a||r||e.setState({showMenu:!0}),n&&r&&e.setState({showMenu:!1})},e.render=function(){var t=e.state,n=t.value,a=t.showMenu,s=e.props,o=s.id,c=s.deleteField,l=s.moveField;return r.a.createElement(z,{className:"with-border ".concat(a?"show-menu":""," stretch"),onMouseEnter:function(){return e.setState({onHover:!0})},onMouseLeave:function(){return e.setState({onHover:!1})},id:o,deleteField:c,moveField:l},r.a.createElement(S,{value:n,className:"text field story-item",tagName:"div",placeholder:"...",onChange:function(t){return e.setState({value:t.target.value})},onFocus:function(){return e.setState({onFocus:!0})},onBlur:function(){return e.setState({onFocus:!1})}}))},e}return n}(r.a.Component),V=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).showMenuClass="show-menu",e.state={value:"",onFocus:!1,onHover:!1,showMenu:!1},e.componentDidUpdate=function(){var t=e.state,n=t.onFocus,a=t.onHover,r=t.showMenu;n||!a||r||e.setState({showMenu:!0}),n&&r&&e.setState({showMenu:!1})},e.render=function(){var t=e.state,n=t.value,a=t.showMenu,s=e.props,o=s.id,c=s.deleteField,l=s.moveField;return r.a.createElement(z,{className:"with-border ".concat(a?e.showMenuClass:""," stretch"),onMouseEnter:function(){return e.setState({onHover:!0})},onMouseLeave:function(){return e.setState({onHover:!1})},id:o,deleteField:c,moveField:l},r.a.createElement(S,{value:n,className:"quote field story-item",tagName:"div",placeholder:"...",onChange:function(t){return e.setState({value:t.target.value})},onFocus:function(){return e.setState({onFocus:!0})},onBlur:function(){return e.setState({onFocus:!1})}}))},e}return n}(r.a.Component),W=function(e){var t=e.deleteField,n=e.moveField,a=e.urlToImage,s=e.id;return r.a.createElement(z,{deleteField:t,moveField:n,id:s,className:"show-menu with-border stretchs"},r.a.createElement("img",{src:a,alt:"",className:"image-field story-item img"}))},Z=function(e){var t=e.deleteField,n=e.moveField,a=e.id;return r.a.createElement(z,{deleteField:t,moveField:n,className:"show-menu distributor-menu",id:a},r.a.createElement("div",{className:"distributor  story-item"}))},$=function(e){var t=e.fiedls,n=e.removeFieldFunc,s=e.moveFieldFunc,o=Object(a.useState)([]),c=Object(g.a)(o,2),l=c[0],i=c[1],u=Object(a.useCallback)((function(e){return e.map((function(e){var t=e.id,a=e.type;if("text"===a)return r.a.createElement(X,{key:t,id:t,deleteField:n,moveField:s});if("quote"===a)return r.a.createElement(V,{key:t,id:t,deleteField:n,moveField:s});if("distributor"===a)return r.a.createElement(Z,{key:t,id:t,deleteField:n,moveField:s});var o=a.split(" ")[1];return r.a.createElement(W,{key:t,id:t,deleteField:n,moveField:s,urlToImage:o})}))}),[s,n]);return Object(a.useEffect)((function(){i(u(t))}),[u,t]),r.a.createElement("div",{className:"body"},l)},J=h()((function(e){var t=e.children,n=e.onClick,a=e.className,s=e.storytellerService;return r.a.createElement("label",{className:a},r.a.createElement("input",{type:"file",onChange:function(e){s.image.post(e.target.files[0]).then((function(e){n("img ".concat(s.image.get(e)))})).catch((function(){})),e.target.value=null},accept:".jpg, .jpeg, .png",name:"upload-image"}),r.a.createElement("span",null,t))})),Q=function(e){var t=e.addField;return r.a.createElement("div",{className:"add-field-buttons-group"},r.a.createElement("button",{className:"add-field add-text-field",onClick:function(){return t("text")}},r.a.createElement("span",null,"\u0422\u0435\u043a\u0441\u0442")),r.a.createElement("button",{className:"add-field add-quote-field",onClick:function(){return t("quote")}},r.a.createElement("span",null,"\u0426\u0438\u0442\u0430\u0442\u0430")),r.a.createElement(J,{className:"add-field add-img-field",onClick:t},"\u0417\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f"),r.a.createElement("button",{className:"add-field add-distributor",onClick:function(){return t("distributor")}},r.a.createElement("span",null,"\u0420\u043e\u0437\u043f\u043e\u0434\u0456\u043b\u044e\u0432\u0430\u0447")))},ee=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).state={bodyField:[{type:"text",id:0}]},e.generateId=function(){return Date.now().toString()+Math.random()},e.addField=function(t){return e.setState((function(n){var a=n.bodyField;return{bodyField:[].concat(Object(w.a)(a),[{type:t,id:e.generateId()}])}}))},e.removeField=function(t){var n=e.state.bodyField,a=n.findIndex((function(e){return e.id===t})),r=n.slice(0,n.length);r.splice(a,1),e.setState({bodyField:r})},e.moveField=function(t,n){var a=e.state.bodyField,r=a.slice(0,a.length);r.splice(t,1),r.splice(n,0,a[t]),e.setState({bodyField:r})},e.render=function(){var t=e.state.bodyField;return r.a.createElement("div",{className:"story-editor"},r.a.createElement(H,null),r.a.createElement($,{fiedls:t,removeFieldFunc:e.removeField,moveFieldFunc:e.moveField}),r.a.createElement(Q,{addField:e.addField}))},e}return n}(r.a.Component),te=(n(61),n(62),n(36)),ne=n.n(te),ae=function(e){var t=e.title,n=e.body,a=e.urlToImage,s=e.publishedAt,o=e.likes,c=e.comments,l=e.views,i=e.id,u=e.className,m=void 0===u?"":u,d=Object(E.g)();return r.a.createElement("div",{className:"story-preview ".concat(m),onClick:function(){d.push("/stories/"+i)}},r.a.createElement("div",{className:"img"},r.a.createElement("img",{src:a||ne.a,alt:""})),r.a.createElement("div",{className:"body"},r.a.createElement("div",{className:"main-info"},r.a.createElement("h3",null,t),r.a.createElement("p",null,n)),r.a.createElement("div",{className:"bottom-group"},r.a.createElement("div",{className:"left"},r.a.createElement("div",{className:"likes num"},r.a.createElement("span",null,o)),r.a.createElement("div",{className:"comments num"},r.a.createElement("span",null,c)),r.a.createElement("div",{className:"views num"},r.a.createElement("span",null,l))),r.a.createElement("div",{className:"right"},r.a.createElement("div",{className:"publishedAt"},s?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,s.day," "),r.a.createElement("span",null,s.month," "),r.a.createElement("span",null,s.year)):null)))))},re=(n(63),function(e){var t=e.storiesList,n=Object(a.useState)([]),s=Object(g.a)(n,2),o=s[0],c=s[1];return Object(a.useEffect)((function(){var e=t.map((function(e){var t=e.publishedAt,n=e.views,a=e.comments,s=e.likes,o=e._id,c=e.previewImage,l=e.previewTitle,i=e.previewBody;return r.a.createElement("div",{className:"story-preview__container",key:o},r.a.createElement(ae,{id:o,likes:s.length,comments:a.length,views:n,body:i||"...",title:l,publishedAt:t,urlToImage:c}))}));c(e)}),[t]),r.a.createElement("div",{className:"stories-container"},o)}),se=(n(64),n(65),function(){return r.a.createElement("div",{className:"simple-loader-container"},r.a.createElement("div",{className:"loader"}))}),oe=(n(66),function(){return r.a.createElement("h3",{className:"find-nothing"},"\u0417\u0430 \u0432\u0430\u0448\u0438\u043c \u0437\u0430\u043f\u0438\u0442\u043e\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0456\u0432 \u043d\u0435 \u0437\u043d\u0430\u0439\u0448\u043b\u043e\u0441\u044f")}),ce=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).input=r.a.createRef(),e.state={stories:[],search:"",usedGenres:[],sortBy:"\u0421\u043f\u043e\u0447\u0430\u0442\u043a\u0443 \u043d\u043e\u0432\u0456\u0448\u0456",openSortByFilter:!1,loading:!1},e.createFilter=function(){var t=e.state,n=t.usedGenres,a=t.search,r={find:{},selection:{}};switch(t.sortBy){case"\u0421\u043f\u043e\u0447\u0430\u0442\u043a\u0443 \u043d\u043e\u0432\u0456\u0448\u0456":r.sort={publishedAt:-1};break;case"\u0421\u043f\u043e\u0447\u0430\u0442\u043a\u0443 \u043d\u0430\u0439\u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u0456\u0448\u0456":r.sort={views:-1,likes:-1}}a.length>0&&(r.find.previewTitle={$regex:".*".concat(a,".*")}),n.length>0&&(r.where={key:"genres",value:n}),r.selection={publishedAt:!0,views:!0,"comments._id":!0,"likes._id":!0,_id:!0,previewImage:!0,previewTitle:!0,previewBody:!0},e.setState({stories:[],loading:!0}),e.getStories(r)},e.getStories=function(t){e.props.storytellerService.stories.getAll(t).then((function(t){e.setState({stories:t,loading:!1})})).catch((function(){e.setState({stories:[],loading:!1})}))},e.handleSearch=function(t){var n=t.target.value;e.setState({search:n})},e.removeLastUsedGenre=function(){var t=e.state.usedGenres;console.log(123);var n=t.slice(0,t.length-1);n.splice(n.length,1),e.setState({usedGenres:n})},e.addGenre=function(t){var n=e.state.usedGenres;-1!==n.findIndex((function(e){return e===t}))?e.removeGenre(t):e.setState({usedGenres:[].concat(Object(w.a)(n),[t])})},e.removeGenre=function(t){e.setState((function(e){var n=e.usedGenres,a=n.findIndex((function(e){return e===t}));if(-1===a)return{usedGenres:n};var r=n.slice(0,n.length);return r.splice(a,1),{usedGenres:r}}))},e.handleFocus=function(){e.input.current.focus()},e.changeSortByFilter=function(t){e.setState({sortBy:t})},e.handleMouseDown=function(t){for(var n=t.path,a=!0,r=0;r<n.length-2;r++)if(n[r].classList.contains("sort-by-filter")){a=!1;break}a&&e.setState({openSortByFilter:!1}),document.removeEventListener("mouseup",e.handleMouseDown,!1)},e.openSortByFilter=function(){e.setState((function(t){var n=t.openSortByFilter;return n||document.addEventListener("mouseup",e.handleMouseDown,!1),{openSortByFilter:!n}}))},e.onKeyDown=function(t){"Enter"===t.key&&e.createFilter()},e.componentDidMount=function(){document.title="\u0420\u043e\u0437\u043f\u043e\u0432\u0456\u0434\u0456 \u2013 Storyteller",e.createFilter(),document.addEventListener("keydown",e.onKeyDown,!1)},e.componentWillUnmount=function(){document.removeEventListener("mouseup",e.handleMouseDown,!1),document.removeEventListener("keydown",e.onKeyDown,!1)},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.stories,a=t.search,s=t.usedGenres,o=t.sortBy,c=t.openSortByFilter,l=t.loading,i=this.props.genresList,u=!1;return l||0!==n.length||(u=!0),r.a.createElement("div",{className:"stories-page"},r.a.createElement("div",{className:"filter"},r.a.createElement("div",{className:"search",onClick:this.handleFocus},r.a.createElement("div",{className:"icon",onClick:this.handleFocus}),r.a.createElement("input",{type:"text",value:a,placeholder:"\u041f\u043e\u0448\u0443\u043a",onChange:this.handleSearch,ref:this.input})),r.a.createElement(O,{removeLastUsedGenre:this.removeLastUsedGenre,usedGenres:s,genresList:i,addGenre:this.addGenre,removeGenre:this.removeGenre}),r.a.createElement("div",{className:"sort-by-filter ".concat(c?"open":""),onClick:function(){return e.openSortByFilter()}},r.a.createElement("div",{className:"sort-by-preview"},r.a.createElement("span",null,o)),r.a.createElement("div",{className:"sort-by-filters"},r.a.createElement("div",{className:"sort-by",onClick:function(){return e.changeSortByFilter("\u0421\u043f\u043e\u0447\u0430\u0442\u043a\u0443 \u043d\u043e\u0432\u0456\u0448\u0456")}},r.a.createElement("span",null,"\u0421\u043f\u043e\u0447\u0430\u0442\u043a\u0443 \u043d\u043e\u0432\u0456\u0448\u0456")),r.a.createElement("div",{className:"sort-by",onClick:function(){return e.changeSortByFilter("\u0421\u043f\u043e\u0447\u0430\u0442\u043a\u0443 \u043d\u0430\u0439\u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u0456\u0448\u0456")}},r.a.createElement("span",null,"\u0421\u043f\u043e\u0447\u0430\u0442\u043a\u0443 \u043d\u0430\u0439\u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u0456\u0448\u0456")))),r.a.createElement("div",{className:"blue-btn small",onClick:this.createFilter},r.a.createElement("button",null,r.a.createElement("span",null,"\u0417\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u0442\u0438")))),l?r.a.createElement(se,null):u?r.a.createElement(oe,null):r.a.createElement(re,{storiesList:n}))}}]),n}(r.a.Component),le=Object(c.b)((function(e){return{genresList:e.genresList}}))(h()(ce)),ie=(n(67),n(33),function(e){var t=e.children,n=e.className,a=e.tagName,s=e._ref,o=e.onClick;return r.a.createElement(N.a,{className:"story-block ".concat(n),tagName:a,html:t,disabled:!0,ref:s,onClick:o})}),ue=function(e){var t=e.backgroundImage,n=e.func,a=e.children,s=e.closeContextMenu;return r.a.createElement("div",{className:"context-menu-item",onClick:function(){n(),s()}},r.a.createElement("div",{className:"icon",style:{backgroundImage:"url(".concat(t,")")||!1}}),r.a.createElement("div",{className:"item-text"},r.a.createElement("span",null,a)))},me=(n(68),function(e){var t=e.items,n=e.open,s=e.contextX,o=e.contextY,c=e.closeFunc,l=Object(a.useState)([]),i=Object(g.a)(l,2),u=i[0],m=i[1],d=Object(a.useState)(!1),p=Object(g.a)(d,2),f=p[0],v=p[1];Object(a.useEffect)((function(){var e=t.map((function(e){var t=e.text,n=e.func,a=e.id,s=e.backgroundImage;return r.a.createElement(ue,{key:a,backgroundImage:s,func:n,closeContextMenu:c},t)}));m(e)}),[t,c]);var h=Object(a.useCallback)((function(){document.removeEventListener("scroll",h,!1),document.removeEventListener("wheel",h,!1),c()}),[c]),E=Object(a.useCallback)((function(e){for(var t=e.path,n=!0,a=0;a<t.length-2;a++)if(t[a].classList.contains("context-menu-container")){n=!1;break}n&&(h(),document.removeEventListener("mouseup",E,!1))}),[h]);return Object(a.useEffect)((function(){n&&(document.removeEventListener("mouseup",E,!1),document.addEventListener("mouseup",E,!1),document.removeEventListener("scroll",h,!1),document.addEventListener("scroll",h,!1),document.removeEventListener("wheel",h,!1),document.addEventListener("wheel",h,!1));var e=window.innerHeight-o,a=30*t.length+30;v(e<=a)}),[h,E,n,o,t.length]),r.a.createElement("div",{className:"context-menu-container ".concat(n?"open":""),style:{left:s,top:o}},r.a.createElement("div",{className:"context-menu-inner ".concat(f?"reverse":"")},u))}),de=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).loadMyLike=!0,e.loadMyComment=!0,e.bigCommentBlock=r.a.createRef(),e.state={urlToImage:null,surname:null,username:null,name:null,storyId:null,commentId:null,likes:[],showComment:!1,bigComment:!1,liked:!1,myComment:!1,openContextMenu:!1,contextX:0,contextY:0},e.componentDidUpdate=function(){var t=e.state.likes,n=e.props,a=n.userData,r=n.userId,s=n.body,o=a.userId;e.loadMyLike&&(o&&(-1!==t.findIndex((function(e){return e.userId===o}))&&e.setState({liked:!0}),r===o&&e.setState({myComment:!0}),e.loadMyLike=!1));e.loadMyComment&&s&&(e.bigCommentBlock.current.el.current.clientHeight>200&&e.setState({bigComment:!0}),e.loadMyComment=!1)},e.likeComment=function(){e.redirectToLoginFromUnauth((function(){var t=e.props,n=t.storytellerService,a=t.storyId,r=t.id,s=e.state.liked,o=n.stories;(o=s?o.commentUnlike:o.commentLike)(a,r).then((function(){e.setState((function(e){var t=e.liked,n=e.likes;return t?n.pop(0):n.push({ob:1}),{liked:!t,likes:n}}))})).catch(e.serverError)}))},e.loadLikes=function(){var t=e.props,n=t.storytellerService,a=t.id,r=t.storyId,s={"comments._id":a};n.stories.getSmallData(r,{likes:!0},s).then((function(t){var n=t.likes;console.log(n),e.setState({likes:n})})).catch(e.serverError)},e.componentDidMount=function(){e.loadComment()},e.loadComment=function(){var t=e.props,n=t.storytellerService,a=t.userId,r=t.likes;e.setState({likes:r});n.users.getById(a,{username:!0,name:!0,surname:!0,urlToImage:!0}).then((function(t){var n=t.username,a=t.surname,r=t.name,s=t.urlToImage;e.setState({username:n,surname:a,name:r,urlToImage:s})})).catch((function(){e.setState({username:"",name:"\u0412\u0438\u0434\u0430\u043b\u0435\u043d\u0438\u0439 \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447"})}))},e.openAllComment=function(){e.state.bigComment&&e.setState((function(e){return{showComment:!e.showComment}}))},e.openAllCommentFromCommentText=function(){e.state.showComment&&e.openAllComment()},e.openContextMenu=function(t){var n=t.clientX,a=t.clientY;e.setState({openContextMenu:!0,contextX:n,contextY:a})},e.closeContextMenu=function(){e.setState({openContextMenu:!1})},e.complainComment=function(){return e.redirectToLoginFromUnauth((function(){(0,e.props.addErrorBanner)("\u0421\u043a\u0430\u0440\u0433\u0430 \u0431\u0443\u0434\u0435 \u0440\u043e\u0437\u043b\u044f\u043d\u0443\u0442\u0430",3)}))},e.removeComment=function(){e.redirectToLoginFromUnauth((function(){var t=e.props,n=t.storyId,a=t.id,r=t.storytellerService,s=t.updateCommentsList;r.stories.removeComment(n,a).then((function(){s()})).catch(e.serverError)}))},e.redirectToLoginFromUnauth=function(t,n){var a=e.props,r=a.needLogin,s=a.location.pathname,o=a.history,c=a.setNextRoute;r?(c(s),o.push("/registration"),n&&n()):t()},e.serverError=function(t){var n=e.props.addErrorBanner;console.log(t),n("\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u0447\u0435\u0440\u0435\u0437 \u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434",3)},e.render=function(){var t=e.state,n=t.username,a=t.name,s=t.surname,o=t.urlToImage,c=t.likes,i=t.liked,u=t.myComment,m=t.showComment,d=t.bigComment,p=t.openContextMenu,f=t.contextX,v=t.contextY,h=e.props,E=h.body,b=void 0===E?"":E,g=h.publishedAt,y=null,w=[];return u?w.push({text:"\u0412\u0438\u0434\u0430\u043b\u0438\u0442\u0438",func:e.removeComment,id:1}):w.push({text:"\u041f\u043e\u0441\u043a\u0430\u0440\u0436\u0438\u0442\u0438\u0441\u044f",func:e.complainComment,id:0}),a&&(y=r.a.createElement("div",{className:"name-and-surname"},r.a.createElement("span",null,a),r.a.createElement("span",null," ",s))),r.a.createElement("div",{className:"comment-container"},r.a.createElement(T,{className:"user-avatar",userId:n,urlToImage:o}),r.a.createElement("div",{className:"comment-inner"},r.a.createElement("div",{className:"author-info"},r.a.createElement("div",{className:"names"},y,r.a.createElement("div",{className:"username"},r.a.createElement(l.b,{to:"/authors/".concat(n)},r.a.createElement("span",null,"@",n)))),r.a.createElement("div",{className:"comment-context-menu-open-btn",onClick:e.openContextMenu})),r.a.createElement("div",{className:"".concat(m?"open":""," ").concat(d?"":"hidden"," user-comment"),onClick:e.openAllCommentFromCommentText},r.a.createElement(ie,{className:"comment-text",tagName:"div",_ref:e.bigCommentBlock},b),r.a.createElement("div",{className:"all-comment-btn ".concat(m?"open":""),onClick:e.openAllComment},r.a.createElement("span",null,"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u0438 \u043f\u043e\u0432\u043d\u0456\u0441\u0442\u044e"))),r.a.createElement("div",{className:"bottom"},r.a.createElement("div",{className:"left"},r.a.createElement("div",{className:"likes num ".concat(i?"active":""),onClick:e.likeComment},r.a.createElement("span",null,c.length.toLocaleString("en")))),r.a.createElement("div",{className:"right"},r.a.createElement("div",{className:"publishedAt"},g?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,g.day," "),r.a.createElement("span",null,g.month," "),r.a.createElement("span",null,g.year)):null)))),r.a.createElement(me,{items:w,open:p,contextX:f,contextY:v,closeFunc:e.closeContextMenu}))},e}return n}(r.a.Component),pe=Object(c.b)((function(e){return{userData:e.userData,needLogin:e.needLogin}}),b)(h()(Object(E.h)(de))),fe=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).state={comment:""},e.handleChange=function(t){var n=t.target.value;return e.setState({comment:n})},e.handleComment=function(){var t=e.state.comment,n=e.props,a=n.storyId,r=n.storytellerService,s=n.loadComments,o=n.addErrorBanner;t.length>0?r.stories.comment(a,t).then((function(){e.setState({comment:""}),s()})).catch((function(){o("\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u0447\u0435\u0440\u0435\u0437 \u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434",3)})):o("\u041a\u043e\u043c\u0435\u043d\u0442\u0430\u0440 \u043d\u0435 \u043f\u043e\u0432\u0438\u043d\u0435\u043d \u0431\u0443\u0442\u0438 \u043f\u043e\u0440\u043e\u0436\u043d\u0456\u043c",5,"white")},e.render=function(){var t=e.state.comment,n=e.props.userData,a=n.name,s=n.surname,o=n.username,c=n.urlToImage,i=null;return a&&s&&(i=r.a.createElement("div",{className:"name-and-surname"},r.a.createElement("span",null,a," "),r.a.createElement("span",null,s))),r.a.createElement("div",{className:"comment-container"},r.a.createElement(T,{className:"user-avatar",userId:o,urlToImage:c}),r.a.createElement("div",{className:"comment-inner"},r.a.createElement("div",{className:"author-info"},r.a.createElement("div",{className:"names"},i,r.a.createElement("div",{className:"username"},r.a.createElement(l.b,{to:"/authors/".concat(o)},r.a.createElement("span",null,"@",o))))),r.a.createElement(S,{className:"my-comment",value:t,placeholder:"\u0414\u043e\u0434\u0430\u0442\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0456\u0439",onChange:e.handleChange,disabledAutoFocus:!0}),r.a.createElement("div",{className:"blue-btn little-blue-btn"},r.a.createElement("button",{onClick:e.handleComment},r.a.createElement("span",null,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0443\u0432\u0430\u0442\u0438")))))},e}return n}(r.a.Component),ve=Object(c.b)((function(e){return{userData:e.userData}}),b)(h()(fe)),he=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).state={title:null,body:null,date:null,comments:[],likes:[],author:null,views:0,quote:null,userId:null,liked:!1,checkMyLike:!0,storyId:null,username:null,commentBlocks:[]},e.createTitleBlock=function(e){return r.a.createElement(ie,{className:"title",tagName:"h3"},e)},e.createBodyBlocks=function(t){return t.map((function(t,n){var a=t.type,s=t.value,o=null;return"text"===a?o=r.a.createElement(ie,{tagName:"p",className:a,key:n},s):"quote"===a?(o=r.a.createElement(ie,{tagName:"blockquote",className:a,key:n},s),0===n&&(e.setState((function(){return{quote:o}})),o=null)):"hr"===a?o=r.a.createElement("div",{className:"hr",key:n}):"img"===a&&(o=r.a.createElement("img",{src:s,alt:"",key:n})),o}))},e.createBeautyQuote=function(t,n){var a=e.state.username;return t&&n?r.a.createElement("div",{className:"beauty-quote"},t,r.a.createElement(l.b,{to:"/authors/".concat(a)},r.a.createElement("span",{className:"author"},n),r.a.createElement("span",{className:"username"},"@",a))):null},e.loadStory=function(t){var n=t.title,a=t.body,r=t.publishedAt,s=t.userId,o=t.likes,c=t.comments,l=t.views,i=t.previewTitle;document.title=i;var u=e.props.storytellerService,m=e.createBodyBlocks(a);e.setState((function(){return{title:e.createTitleBlock(n),body:m,date:r,views:l,likes:o,comments:c,userId:s}})),e.createComments(c);u.users.getById(s,{username:!0,name:!0,surname:!0}).then((function(t){var n=t.username,a=t.name,r=t.surname,s=null;a&&r&&(s=a+" "+r),e.setState((function(){return{author:s,username:n}}))}))},e.createComments=function(t){var n=e.props,a=n.storytellerService,s=n.match.params.id,o=t.reverse().map((function(t){var n=t._id,o=t.publishedAt,c=t.body,l=t.userId,i=t.likes;return r.a.createElement(pe,{body:c,publishedAt:a.convertData(o),userId:l,likes:i,key:n,storyId:s,id:n,updateCommentsList:e.loadComments})}));e.setState({commentBlocks:o})},e.loadStoryDataOnService=function(t){e.props.storytellerService.stories.get(t).then(e.loadStory).catch((function(){}))},e.componentDidMount=function(){var t=e.props.match.params.id;e.loadStoryDataOnService(t),e.setState({storyId:t})},e.componentDidUpdate=function(){var t=e.props.userData.userId,n=e.state,a=n.likes,r=n.checkMyLike;t&&a.length>0&&r&&(-1!==a.findIndex((function(e){return e.userId===t}))?e.setState({liked:!0,checkMyLike:!1}):e.setState({liked:!1,checkMyLike:!1}))},e.like=function(){var t=e.props,n=t.match.params.id,a=t.storytellerService,r=t.addErrorBanner,s=t.needLogin,o=t.setNextRoute,c=t.location.pathname,l=t.history,i=e.state.liked;if(s)o(c),l.push("/registration");else{var u=a.stories;u=i?u.unlike:u.like,e.setState((function(e){return{liked:!e.liked}})),u(n).then((function(){e.loadLikes()})).catch((function(){r("\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u0447\u0435\u0440\u0435\u0437 \u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434",3)}))}},e.loadLikes=function(){var t=e.props,n=t.storytellerService,a=t.addErrorBanner,r=e.state.storyId;n.stories.getSmallData(r,{likes:!0}).then((function(t){var n=t.likes;e.setState({likes:n})})).catch((function(){a("\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u0447\u0435\u0440\u0435\u0437 \u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434",3)}))},e.loadComments=function(){var t=e.props,n=t.storytellerService,a=t.addErrorBanner,r=e.state.storyId;n.stories.getSmallData(r,{comments:!0}).then((function(t){var n=t.comments;e.setState({comments:n}),e.createComments(n)})).catch((function(){a("\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u0447\u0435\u0440\u0435\u0437 \u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434",3)}))},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.state,t=e.title,n=e.body,a=e.date,s=e.comments,o=e.likes,c=e.author,i=e.views,u=e.quote,m=e.username,d=e.liked,p=e.storyId,f=e.commentBlocks,v=this.props.needLogin,h=this.createBeautyQuote(u,c),E=null;return!h&&m&&(E=r.a.createElement("div",{className:"author-container"},r.a.createElement(l.b,{to:"/authors/".concat(m)},r.a.createElement("span",{className:"author"},c),r.a.createElement("span",{className:"username"},"@",m)))),r.a.createElement("div",{className:"story-page"},r.a.createElement("div",{className:"story"},t,E,h,n,r.a.createElement("h3",{className:"-- to-be-continued ->>"},"\u0414\u0430\u043b\u0456 \u0431\u0443\u0434\u0435")),r.a.createElement("div",{className:"bottom"},r.a.createElement("div",{className:"left"},r.a.createElement("div",{className:"likes num ".concat(d?"active":""),onClick:this.like},r.a.createElement("span",null,o.length.toLocaleString("en"))),r.a.createElement("div",{className:"comments num"},r.a.createElement("span",null,s.length.toLocaleString("en"))),r.a.createElement("div",{className:"views num"},r.a.createElement("span",null,i.toLocaleString("en")))),r.a.createElement("div",{className:"right"},r.a.createElement("div",{className:"publishedAt"},a?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,a.day," "),r.a.createElement("span",null,a.month," "),r.a.createElement("span",null,a.year)):null))),r.a.createElement("div",{className:"comments"},r.a.createElement("div",{className:"user-comments"},v?r.a.createElement("div",{className:"need-login"},r.a.createElement("span",null,"\u0423\u0432\u0456\u0439\u0434\u0456\u0442\u044c, \u0449\u043e\u0431 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0443\u0432\u0430\u0442\u0438")):r.a.createElement(ve,{storyId:p,loadComments:this.loadComments})),r.a.createElement("div",{className:"comment-list"},f)))}}]),n}(r.a.Component),Ee=Object(c.b)((function(e){return{userData:e.userData,needLogin:e.needLogin}}),b)(h()(Object(E.h)(he))),be=(n(69),Object(c.b)((function(e){return{userData:e.userData,needLogin:e.needLogin}}),b)(h()(Object(E.h)((function(e){var t=e.storytellerService,n=e.match,s=e.userData,o=e.addErrorBanner,c=e.needLogin,l=e.location.pathname,i=e.history,u=e.setNextRoute,m=Object(a.useState)([]),d=Object(g.a)(m,2),p=d[0],f=d[1],v=Object(a.useState)({}),h=Object(g.a)(v,2),E=h[0],b=h[1],y=Object(a.useState)(!1),w=Object(g.a)(y,2),k=w[0],S=w[1],j=Object(a.useState)(!1),O=Object(g.a)(j,2),C=O[0],x=O[1],L=Object(a.useState)(null),D=Object(g.a)(L,2),F=D[0],I=D[1],B=Object(a.useState)(!1),M=Object(g.a)(B,2),_=M[0],A=M[1],U=Object(a.useState)([]),G=Object(g.a)(U,2),R=G[0],q=G[1],Y=Object(a.useState)(!1),K=Object(g.a)(Y,2),H=K[0],z=K[1],X=n.params.id,V=E.username,W=E.name,Z=E.surname,$=E.urlToImage,J=E._id,Q=E.about,ee=s.userId,te=s.username,ne=Object(a.useCallback)((function(){if(J){var e={find:{},selection:{}};e.find={userId:J},e.selection={publishedAt:!0,views:!0,"comments._id":!0,"likes._id":!0,_id:!0,previewImage:!0,previewTitle:!0,previewBody:!0},t.stories.getAll(e).then((function(e){f(e)})).catch((function(){}))}}),[t.stories,J]),ae=Object(a.useCallback)((function(){t.users.get(X).then((function(e){b(Object(P.a)({},e)),q(e.followers)})).catch((function(){o("\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0456 \u0432\u0438\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0438, \u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430, \u0441\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u0447\u0435\u0440\u0435\u0437 \u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434",3)}))}),[t.users,X,o]);Object(a.useEffect)((function(){ae(),ne()}),[ae,ne]),Object(a.useEffect)((function(){F&&F.clientHeight>210&&x(!0)}),[F,E]),Object(a.useEffect)((function(){ee&&(-1!==R.findIndex((function(e){return e.userId===ee}))&&A(!0))}),[R,ee]),Object(a.useEffect)((function(){document.title="".concat([W,Z].join(" ")).concat(W?" ":"","@").concat(V||"\u0430\u0432\u0442\u043e\u0440")}),[V,W,Z]),Object(a.useEffect)((function(){z(te===X)}),[X,te]);var se=function(){t.users.getSmallData(X,{followers:!0}).then((function(e){var t=e.followers;q(t)})).catch((function(){}))},oe=function(){C&&S(!k)};return r.a.createElement("div",{className:"user-page"},r.a.createElement("div",{className:"user-panel-container"},r.a.createElement("div",{className:"top"},r.a.createElement(T,{className:"user-avatar",userId:V,urlToImage:$}),r.a.createElement("div",{className:"right"},r.a.createElement("div",{className:"user-names"},r.a.createElement("div",{className:"name-and-surname"},r.a.createElement("span",null,W),r.a.createElement("span",null,Z)),r.a.createElement("div",{className:"username"},r.a.createElement("span",null,"@",V))),r.a.createElement("div",{className:"followers-panel"},H?null:r.a.createElement("div",{className:"follow-btn ".concat(_?"unfollow":""),onClick:function(){if(c)u(l),i.push("/registration");else if(ee===J)o("\u0412\u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u0456\u0434\u043f\u0438\u0441\u0430\u0442\u0438\u0441\u044f \u043d\u0430 \u0441\u0435\u0431\u0435",3);else{var e=t.users;_?(e=e.unfollow,A(!1)):(e=e.follow,A(!0)),e(J).then((function(){se()})).catch((function(){o("\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u0447\u0435\u0440\u0435\u0437 \u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434",3)}))}}},r.a.createElement("span",null,_?"\u0412\u0456\u0434\u043f\u0438\u0441\u0430\u0442\u0438\u0441\u044f":"\u041f\u0456\u0434\u043f\u0438\u0441\u0430\u0442\u0438\u0441\u044c")),r.a.createElement("div",{className:"followers-panel-inner"},r.a.createElement("div",{className:"followers-list"},r.a.createElement("div",{className:"logo"}),r.a.createElement("div",{className:"followers-list-inner"},r.a.createElement("span",{className:"number"},R.length.toLocaleString("en")),r.a.createElement("span",null,"\u043f\u0456\u0434\u043f\u0438\u0441\u043d\u0438\u043a\u0456\u0432"))),r.a.createElement("div",{className:"stories-list-length"},r.a.createElement("div",{className:"logo"}),r.a.createElement("div",{className:"stories-list-inner"},r.a.createElement("span",null,"\u0456\u0441\u0442\u043e\u0440\u0456\u0439:"),r.a.createElement("span",{className:"number"},p.length))))))),r.a.createElement("div",{className:"bottom"},Q?r.a.createElement("div",{className:"about-user ".concat(k?"open":""," ").concat(C?"":"hidden"),ref:function(e){return I(e)},onClick:function(){k&&oe()}},r.a.createElement(N.a,{html:Q,tagName:"p",className:"about-user-text",disabled:!0}),r.a.createElement("div",{className:"all-about-user-btn ".concat(k?"open":""),onClick:oe},r.a.createElement("span",null,"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u0438 \u043f\u043e\u0432\u043d\u0456\u0441\u0442\u044e"))):null)),r.a.createElement(re,{storiesList:p}))}))))),ge=Object(E.h)((function(e){var t=e.name,n=e.surname,a=e.urlToImage,s=e.username,o=e.followers;e.history;return r.a.createElement("div",{className:"author-block"},r.a.createElement(T,{className:"user-avatar",userId:s,urlToImage:a}),r.a.createElement("div",{className:"right"},r.a.createElement("div",{className:"user-names"},r.a.createElement("div",{className:"name-and-surname"},r.a.createElement("span",null,t),r.a.createElement("span",null,n)),r.a.createElement("div",{className:"username"},r.a.createElement(l.b,{to:"/authors/".concat(s)},r.a.createElement("span",null,"@",s)))),r.a.createElement("div",{className:"followers-list"},r.a.createElement("div",{className:"logo"}),r.a.createElement("div",{className:"followers-list-inner"},r.a.createElement("span",{className:"number"},o.length.toLocaleString("en")),r.a.createElement("span",null,"\u043f\u0456\u0434\u043f\u0438\u0441\u043d\u0438\u043a\u0456\u0432")))))})),ye=(n(70),function(){return r.a.createElement("h3",{className:"find-nothing"},"\u0417\u0430 \u0432\u0430\u0448\u0438\u043c \u0437\u0430\u043f\u0438\u0442\u043e\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0456\u0432 \u043d\u0435 \u0437\u043d\u0430\u0439\u0448\u043b\u043e\u0441\u044f")}),we=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).input=r.a.createRef(),e.state={authorsList:[],search:"",loading:!0},e.createAuthorsList=function(t){var n=e.props,a=n.storytellerService,r=n.addErrorBanner,s=a.users.getAll;(s=t?s(0,20,{},t):s(0,20)).then((function(t){e.createAuthorBlocks(t)})).catch((function(){r("\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0456 \u0432\u0438\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0438, \u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430, \u0437\u0430\u0447\u0435\u043a\u0430\u0439\u0442\u0435",5,"white")}))},e.createAuthorBlocks=function(t){var n=t.map((function(e){var t=e.urlToImage,n=e.username,a=e.name,s=e.surname,o=e._id,c=e.followers;return r.a.createElement(ge,{key:o,urlToImage:t,name:a,surname:s,username:n,followers:c})}));e.setState((function(e){e.authorsList;return{authorsList:n,loading:!1}}))},e.handleSearch=function(t){var n=t.target.value;e.setState({search:n})},e.handleFocus=function(){e.input.current.focus()},e.createFilter=function(){var t=e.state.search,n={};t.length>0&&(n.username={$regex:".*".concat(t,".*")}),e.setState({authorsList:[],loading:!0}),e.createAuthorsList(n)},e.onKeyDown=function(t){"Enter"===t.key&&e.createFilter()},e.componentDidMount=function(){document.title="\u0410\u0432\u0442\u043e\u0440\u0438 \u2013 Storyteller",e.createAuthorsList(),document.addEventListener("keydown",e.onKeyDown,!1)},e.componentWillUnmount=function(){document.removeEventListener("keydown",e.onKeyDown,!1)},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.state,t=e.authorsList,n=e.search,a=e.loading,s=!1;return a||0!==t.length||(s=!0),r.a.createElement("div",{className:"authors"},r.a.createElement("div",{className:"filter"},r.a.createElement("div",{className:"search",onClick:this.handleFocus},r.a.createElement("div",{className:"icon",onClick:this.handleFocus}),r.a.createElement("input",{type:"text",value:n,placeholder:"\u041f\u043e\u0448\u0443\u043a (\u0432\u0432\u0435\u0434\u0456\u0442\u044c \u0456\u043c'\u044f \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0430)",onChange:this.handleSearch,ref:this.input})),r.a.createElement("div",{className:"blue-btn small",onClick:this.createFilter},r.a.createElement("button",null,r.a.createElement("span",null,"\u0417\u0430\u0441\u0442\u043e\u0441\u0443\u0432\u0430\u0442\u0438")))),a?r.a.createElement(se,null):s?r.a.createElement(ye,null):t)}}]),n}(r.a.Component),ke=Object(c.b)((function(){return{}}),b)(h()(we)),Ne=(n(71),function(e){var t=e.className,n=e.urlToImage,a=e.onClick;return r.a.createElement("div",{className:"".concat(t," ").concat(n?"":"default"),style:n?{backgroundImage:"url(".concat(n,")")}:{},onClick:a})}),Se=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).imageForm=r.a.createRef(),e.state={username:"",name:"",surname:"",about:"",email:"",loadMyData:!0,trueEmail:!0,trueUser:!0,usernameTimer:null,updateButtonEnable:!1},e.componentDidUpdate=function(){var t=e.state,n=t.trueUser,a=t.updateButtonEnable,r=t.trueEmail;e.loadMyData(),r&&n?a||e.setState({updateButtonEnable:!0}):a&&e.setState({updateButtonEnable:!1})},e.loadMyData=function(){var t=e.state.loadMyData,n=e.props.userData,a=n.username,r=void 0===a?"":a,s=n.email,o=void 0===s?"":s,c=n.name,l=void 0===c?"":c,i=n.surname,u=void 0===i?"":i,m=n.about,d=void 0===m?"":m;t&&r&&e.setState({username:r,email:o,name:l,surname:u,about:d,loadMyData:!1})},e.componentDidMount=function(){e.loadMyData()},e.clickOnImageForm=function(){e.imageForm.current.click()},e.uploadImage=function(t){var n=e.props,a=n.storytellerService,r=n.addErrorBanner;a.image.post(t.target.files[0]).then((function(t){a.users.update({urlToImage:"".concat(a.image.get(t))}).then((function(){e.loadSmallData({urlToImage:!0})})).catch((function(){e.serverError()}))})).catch((function(t){400===t?r("\u041c\u043e\u0436\u043d\u0430 \u0437\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0443\u0432\u0430\u0442\u0438 \u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u043d\u044f \u0443 \u0444\u043e\u0440\u043c\u0430\u0442\u0456 png, jpg, jpeg"):e.serverError()})),t.target.value=null},e.loadSmallData=function(t,n){var a=e.props,r=a.storytellerService,s=a.userData,o=a.updateUserData,c=a.addErrorBanner,l=s.username;r.users.getSmallData(n||l,t).then((function(e){o(Object(P.a)({},e)),c("\u041e\u043d\u043e\u0432\u043b\u0435\u043d\u043e",3)})).catch((function(){console.log("error")}))},e.updateUserData=function(){var t=e.props,n=t.storytellerService,a=t.userData,r=e.state,s=r.username,o=r.email,c=r.name,l=r.surname,i=r.about,u=a.username,m=a.email,d=a.name,p=a.surname,f=a.about,v={};s!==u&&(v.username=s),o!==m&&(v.email=o),c!==d&&(v.name=c),l!==p&&(v.surname=l),i!==f&&(v.about=i),n.users.update(v).then((function(){e.loadSmallData(v,s!==u?s:void 0)})).catch((function(){e.serverError()}))},e.handleClick=function(){e.updateUserData()},e.serverError=function(){(0,e.props.addErrorBanner)("\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0456 \u0432\u0438\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0438, \u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430, \u0437\u0430\u0447\u0435\u043a\u0430\u0439\u0442\u0435",3)},e.usernameU=function(t){var n=t.target.value;e.setState({username:e.correctUsername(n)})},e.emailU=function(t){var n=t.target.value;return e.setState({email:e.correctEmail(n)})},e.correctUsername=function(t){var n=e.props,a=n.addErrorBanner,r=n.storytellerService,s=n.userData.username;return r.checkUsername(t).then((function(n){var r=function(){var t=e.state.usernameTimer;clearTimeout(t)},o=function(t,n){r(),e.setState({usernameTimer:setTimeout((function(){a(t,n,"white")}),500),trueUser:!1})};if(0!==t.length)switch(n){case"busy":t===s?e.setState({trueUser:!0}):o("\u0414\u0430\u043d\u0438\u0439 \u043d\u0456\u043a\u043d\u0435\u0439\u043c \u0432\u0436\u0435 \u043a\u0438\u043c\u043e\u0441\u044c \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u044c\u0441\u044f",3);break;case"incorrect":o('\u0414\u043e\u0432\u0436\u0438\u043d\u0430 \u043d\u0456\u043a\u043d\u0435\u0439\u043c\u0430 \u0432\u0456\u0434 4 \u0434\u043e 16 \u0441\u0438\u043c\u043e\u043b\u0456\u0432. \u041c\u043e\u0436\u043d\u0430 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u043b\u0430\u0442\u0438\u043d\u0441\u044c\u043a\u0456 \u043b\u0456\u0442\u0435\u0440\u0438, \u0446\u0438\u0444\u0440\u0438 \u0442\u0430 \u043d\u0438\u0436\u043d\u0456 \u043f\u0456\u0434\u043a\u0440\u0435\u0441\u043b\u0435\u043d\u043d\u044f "_"',3);break;default:r(),e.setState({trueUser:!0})}})).catch((function(){a("\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0456 \u0432\u0438\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0438, \u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430, \u0437\u0430\u0447\u0435\u043a\u0430\u0439\u0442\u0435",3,"white")})),t},e.correctEmail=function(t){var n=e.props,a=n.addErrorBanner,r=n.storytellerService,s=n.userData.email;return r.checkEmail(t).then((function(n){var r=function(){var t=e.state.usernameTimer;clearTimeout(t)},o=function(t,n){r(),e.setState({usernameTimer:setTimeout((function(){a(t,n,"white")}),2500),trueEmail:!1})};if(0!==t.length)switch(n){case"busy":t===s?e.setState({trueEmail:!0}):o("\u0414\u0430\u043d\u0438\u0439 \u0435\u043c\u0435\u0439\u043b \u0432\u0436\u0435 \u0432\u0438\u043a\u043e\u0440\u0438\u0441\u0442\u043e\u0432\u0443\u0454\u0442\u044c\u0441\u044f",3);break;case"incorrect":o("\u0412\u0432\u0435\u0434\u0456\u0442\u044c \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u0438\u0439 \u0435\u043c\u0435\u0439\u043b",3);break;default:r(),e.setState({trueEmail:!0})}})).catch((function(){a("\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0456 \u0432\u0438\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0438, \u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430, \u0437\u0430\u0447\u0435\u043a\u0430\u0439\u0442\u0435",3,"white")})),t},e.nameU=function(t){var n=t.target.value;e.setState({name:n})},e.surnameU=function(t){var n=t.target.value;e.setState({surname:n})},e.aboutU=function(t){var n=t.target.value;e.setState({about:n})},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.userData.urlToImage,t=this.state,n=t.username,a=t.name,s=t.surname,o=t.email,c=t.about,l=t.updateButtonEnable;return r.a.createElement("div",{className:"profile-edit setting-inner"},r.a.createElement("div",{className:"user-preview"},r.a.createElement("div",{className:"user-avatar-container"},r.a.createElement(Ne,{className:"user-avatar",urlToImage:e,onClick:this.clickOnImageForm})),r.a.createElement("div",{className:"right"},r.a.createElement("div",{className:"username"},r.a.createElement("span",null,"@",n)),r.a.createElement("button",{className:"change-my-avatar",onClick:this.clickOnImageForm},"\u0417\u043c\u0456\u043d\u0438\u0442\u0438 \u043e\u0441\u043d\u043e\u0432\u043d\u0443 \u0441\u0432\u0456\u0442\u043b\u0438\u043d\u0443")),r.a.createElement("input",{type:"file",ref:this.imageForm,onChange:this.uploadImage})),r.a.createElement("div",{className:"user-data"},r.a.createElement("div",{className:"username small-data"},r.a.createElement("aside",null,"\u041d\u0456\u043a\u043d\u0435\u0439\u043c"),r.a.createElement("input",{type:"text",placeholder:"...",value:n,onChange:this.usernameU,maxLength:"16"})),r.a.createElement("div",{className:"name small-data"},r.a.createElement("aside",null,"\u0406\u043c'\u044f"),r.a.createElement("input",{type:"text",placeholder:"...",value:a,onChange:this.nameU})),r.a.createElement("div",{className:"surname small-data"},r.a.createElement("aside",null,"\u041f\u0440\u0456\u0437\u0432\u0438\u0449\u0435"),r.a.createElement("input",{type:"text",placeholder:"...",value:s,onChange:this.surnameU})),r.a.createElement("div",{className:"email small-data"},r.a.createElement("aside",null,"\u0415\u043c\u0435\u0439\u043b"),r.a.createElement("input",{type:"text",placeholder:"...",value:o,onChange:this.emailU})),r.a.createElement("div",{className:"about small-data"},r.a.createElement("aside",null,"\u041f\u0440\u043e \u0441\u0435\u0431\u0435"),r.a.createElement(S,{placeholder:"...",disabledAutoFocus:!0,tagName:"span",value:c,onChange:this.aboutU})),r.a.createElement("div",{className:"load-my-data small-data"},r.a.createElement("div",{className:"blue-btn small ".concat(l?"":"disabled")},r.a.createElement("button",{onClick:this.handleClick},r.a.createElement("span",null,"\u041d\u0430\u0434\u0456\u0441\u043b\u0430\u0442\u0438"))))))}}]),n}(r.a.Component),je=Object(c.b)((function(e){return{userData:e.userData}}),b)(h()(Se)),Oe=function(e){var t=e.children,n=e.linkTo,s=e.location,o=e.link,c=Object(a.useState)(""),l=Object(g.a)(c,2),i=l[0],u=l[1];return Object(a.useEffect)((function(){s.pathname.includes(o)?u("active"):u("")}),[s,o]),r.a.createElement("button",{onClick:function(){return n(o)},className:i},t)},Ce=Object(c.b)((function(){return{}}),b)(h()((function(e){var t=e.addErrorBanner,n=e.storytellerService,s=Object(a.useState)(""),o=Object(g.a)(s,2),c=o[0],l=o[1],i=Object(a.useState)(""),u=Object(g.a)(i,2),m=u[0],d=u[1],p=Object(a.useState)(""),f=Object(g.a)(p,2),v=f[0],h=f[1],E=Object(a.useState)(!1),b=Object(g.a)(E,2),y=b[0],w=b[1];return Object(a.useEffect)((function(){w(!!(c&&v&&m))}),[c,m,v]),r.a.createElement("div",{className:"change-password-container__settings setting-inner"},r.a.createElement("div",{className:"old-password small-data"},r.a.createElement("aside",null,"\u0421\u0442\u0430\u0440\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"),r.a.createElement("input",{type:"password",placeholder:"...",value:c,onChange:function(e){var t=e.target.value;return l(t)}})),r.a.createElement("div",{className:"new-password1 small-data"},r.a.createElement("aside",null,"\u041d\u043e\u0432\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"),r.a.createElement("input",{type:"password",placeholder:"...",value:m,onChange:function(e){var t=e.target.value;return d(t)}})),r.a.createElement("div",{className:"new2-password small-data"},r.a.createElement("aside",null,"\u041f\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u044c\u0442\u0435 \u043d\u043e\u0432\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"),r.a.createElement("input",{type:"password",placeholder:"...",value:v,onChange:function(e){var t=e.target.value;return h(t)}})),r.a.createElement("div",{className:"load-my-data small-data"},r.a.createElement("div",{className:"blue-btn small ".concat(y?"":"disabled")},r.a.createElement("button",{onClick:function(){m!==v?t("\u041f\u0430\u0440\u043e\u043b\u0456 \u043d\u0435 \u0437\u0431\u0456\u0433\u0430\u044e\u0442\u044c\u0441\u044f",3,"white"):m.length<4?t("\u0421\u0442\u0432\u043e\u0440\u0456\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c \u043c\u0456\u043d\u0456\u043c\u0443\u043c \u0437 5 \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432.",3.5,"white"):n.users.updatePassword(c,m).then((function(){t("\u041e\u043d\u043e\u0432\u043b\u0435\u043d\u043e",3,"white")})).catch((function(){t("\u0412\u0430\u0448 \u0441\u0442\u0430\u0440\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e. \u0412\u0432\u0435\u0434\u0456\u0442\u044c \u0439\u043e\u0433\u043e \u0449\u0435 \u0440\u0430\u0437.",3.5,"white")}))}},r.a.createElement("span",null,"\u041d\u0430\u0434\u0456\u0441\u043b\u0430\u0442\u0438")))))}))),xe=function(e){var t=e.id,n=e.title,a=e.publishedAt,s=e.removeMe,o=e.storyClick;return r.a.createElement("div",{className:"my-story"},r.a.createElement("div",{className:"left"},r.a.createElement("div",{className:"title",onClick:function(){return o(t)}},r.a.createElement("h3",null,n)),r.a.createElement("div",{className:"publishedAt"},a?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,a.day," "),r.a.createElement("span",null,a.month," "),r.a.createElement("span",null,a.year)):null)),r.a.createElement("div",{className:"right"},r.a.createElement("button",{onClick:function(){return s(t)},className:"basket menu-item"})))},Le=function(){return r.a.createElement("h3",{className:"find-nothing"},"\u041f\u0443\u0441\u0442\u043e")},Te=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).state={myStories:[],loading:!0},e.componentDidMount=function(){e.createMyStoriesList()},e.createMyStoriesList=function(){var t=e.props,n=t.userData,a=t.storytellerService,r=n.userId;e.setState({myStories:[],loading:!0}),r&&a.stories.getAll({find:{userId:r},selection:{previewTitle:!0,_id:!0,publishedAt:!0}}).then((function(t){e.buildStoriesList(t),e.setState({loading:!1})})).catch((function(){console.error(404),e.setState({loading:!1})}))},e.buildStoriesList=function(t){var n=t.map((function(t){var n=t._id,a=t.publishedAt,s=t.previewTitle;return r.a.createElement(xe,{key:n,title:s,id:n,removeMe:e.removeStory,publishedAt:a,storyClick:e.storyClick})}));e.setState({myStories:n})},e.storyClick=function(t){e.props.history.push("/stories/".concat(t))},e.removeStory=function(t){var n=e.props,a=n.storytellerService,r=n.addErrorBanner;a.stories.removeStory(t).then((function(){r("\u0406\u0441\u0442\u043e\u0440\u0456\u044f \u0431\u0443\u043b\u0430 \u0432\u0438\u0434\u0430\u043b\u0435\u043d\u0430"),e.createMyStoriesList()})).catch((function(){r("\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430 \u043f\u0456\u0437\u043d\u0456\u0448\u0435",3)}))},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.state,t=e.myStories,n=e.loading,a=!1;return n||0!==t.length||(a=!0),r.a.createElement("div",{className:"my-stories setting-inner"},n?r.a.createElement(se,null):a?r.a.createElement(Le,null):t)}}]),n}(r.a.Component),De=Object(c.b)((function(e){return{userData:e.userData}}),b)(h()(Object(E.h)(Te))),Fe=function(e){var t=e.id,n=e.follow,s=e.getUserById,o=Object(a.useState)({username:"",urlToImage:null}),c=Object(g.a)(o,2),l=c[0],i=c[1],u=l.username,m=l.urlToImage;return Object(a.useEffect)((function(){s(t,{username:!0,urlToImage:!0,_id:!1}).then((function(e){var t=e.username,n=e.urlToImage;i({username:t,urlToImage:n})})).catch((function(){console.error(404)}))}),[s,t]),r.a.createElement("div",{className:"following"},r.a.createElement("div",{className:"left"},r.a.createElement(T,{urlToImage:m,className:"user-avatar"})),r.a.createElement("div",{className:"right"},r.a.createElement("div",{className:"top"},r.a.createElement("span",null,"@",u)),r.a.createElement("div",{className:"bottom"},r.a.createElement("button",{className:"follow",onClick:function(){return n(t)}},"\u0412\u0456\u0434\u043f\u0438\u0441\u0430\u0442\u0438\u0441\u044f"))))},Ie=function(){return r.a.createElement("h3",{className:"find-nothing"},"\u041f\u0443\u0441\u0442\u043e")},Be=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).state={followingsList:[],loading:!0},e.follow=function(t){var n=e.props,a=n.storytellerService,r=n.addErrorBanner;a.users.unfollow(t).then((function(){r("\u0423\u0441\u043f\u0456\u0448\u043d\u043e",3,"white"),e.getMyFollowings()})).catch((function(){r("\u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u0447\u0435\u0440\u0435\u0437 \u0434\u0435\u043a\u0456\u043b\u044c\u043a\u0430 \u0441\u0435\u043a\u0443\u043d\u0434",3,"white")}))},e.componentDidMount=function(){e.getMyFollowings()},e.getMyFollowings=function(){var t=e.props,n=t.userData,a=t.storytellerService,r=n.username;e.setState({loading:!0,followingsList:[]}),r&&a.users.getSmallData(r,{followings:!0}).then((function(t){var n=t.followings;e.createFollowingsList(n),e.setState({loading:!1})})).catch((function(){console.error(404),e.setState({loading:!1})}))},e.createFollowingsList=function(t){var n=e.props.storytellerService,a=t.map((function(t){var a=t.userId;return r.a.createElement(Fe,{key:a,follow:e.follow,id:a,getUserById:n.users.getById})}));e.setState({followingsList:a})},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.state,t=e.followingsList,n=e.loading,a=!1;return n||0!==t.length||(a=!0),r.a.createElement("div",{className:"my-followings setting-inner"},n?r.a.createElement(se,null):a?r.a.createElement(Ie,null):t)}}]),n}(r.a.Component),Me=Object(c.b)((function(e){return{userData:e.userData}}),b)(h()(Object(E.h)(Be))),_e=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).linkTo=function(t){e.props.history.push("/settings".concat(t))},e.logout=function(){var t=e.props,n=t.storytellerService,a=t.login,r=t.userData,s=t.history;n.logout(),a(!0),s.push("/authors/".concat(r.username))},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.location;return r.a.createElement("div",{className:"my-settings"},r.a.createElement("div",{className:"settings-panel"},r.a.createElement("div",{className:"settings-panel-inner"},r.a.createElement(Oe,{linkTo:this.linkTo,link:"/profile",location:e},"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u043f\u0440\u043e\u0444\u0456\u043b\u044c"),r.a.createElement(Oe,{linkTo:this.linkTo,link:"/password",location:e},"\u0417\u043c\u0456\u043d\u0438\u0442\u0438 \u043f\u0430\u0440\u043e\u043b\u044c"),r.a.createElement(Oe,{linkTo:this.linkTo,link:"/stories",location:e},"\u0406\u0441\u0442\u043e\u0440\u0456\u0457"),r.a.createElement(Oe,{linkTo:this.linkTo,link:"/followings",location:e},"\u0421\u0442\u0435\u0436\u0443 \u0437\u0430..."),r.a.createElement("button",{className:"logout",onClick:this.logout},"\u0412\u0438\u0445\u0456\u0434"))),r.a.createElement("div",{className:"setting"},r.a.createElement(E.d,null,r.a.createElement(E.b,{path:"/settings/profile"},r.a.createElement(je,null)),r.a.createElement(E.b,{path:"/settings/password"},r.a.createElement(Ce,null)),r.a.createElement(E.b,{path:"/settings/stories"},r.a.createElement(De,null)),r.a.createElement(E.b,{path:"/settings/followings"},r.a.createElement(Me,null)))))}}]),n}(r.a.Component),Ae=Object(c.b)((function(e){return{userData:e.userData}}),b)(h()(Object(E.h)(_e))),Ue=(n(72),function(e){var t=e.children,n=e.delayTime,s=e.removeMe,o=e.id,c=e.styleClass,l=Object(a.useState)(!1),i=Object(g.a)(l,2),u=i[0],m=i[1],d=Object(a.useRef)(null),p=Object(a.useCallback)((function(){clearTimeout(d.current),m(!1),setTimeout((function(){s(o)}),400)}),[o,s]);return Object(a.useEffect)((function(){setTimeout((function(){m(!0)}),400)}),[]),Object(a.useEffect)((function(){clearTimeout(d.current),d.current=setTimeout(p,1e3*n)}),[n,p]),r.a.createElement("div",{className:"error-banner ".concat(u?"":"hide"," ").concat(c),onClick:p},r.a.createElement("span",null,t))}),Ge=Object(c.b)((function(e){return{errorBanners:e.errorBanners}}),b)((function(e){var t=e.errorBanners,n=e.removeErrorBanner,s=Object(a.useState)([]),o=Object(g.a)(s,2),c=o[0],l=o[1],i=Object(a.useCallback)((function(){var e=t.map((function(e,t){var a=e.message,s=e.delayTime,o=e.id,c=e.style,l=s;return t>0&&(l=0),r.a.createElement(Ue,{key:o,delayTime:l,removeMe:n,id:o,styleClass:c},a)}));l(e)}),[t,n]);return Object(a.useEffect)((function(){i()}),[i]),r.a.createElement("div",{className:"error-banner-container"},c)})),Re=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.login,n=e.loadGenres,a=e.storytellerService,r=e.updateUserData,s=e.addErrorBanner;a.auth().then((function(e){var n=e.status,a=e.username,o=e.name,c=e.surname,l=e.urlToImage,i=e._id,u=e.about,m=e.email;switch(n){case 401:t(!0);break;case 200:t(!1),r({userId:i,username:a,name:o,urlToImage:l,surname:c,about:u,email:m});break;default:s("\u041d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0456 \u0432\u0438\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0438, \u0431\u0443\u0434\u044c-\u043b\u0430\u0441\u043a\u0430, \u0437\u0430\u0447\u0435\u043a\u0430\u0439\u0442\u0435",3)}})),a.genres.getAll().then(n)}},{key:"render",value:function(){var e=this.props.needLogin;return r.a.createElement(r.a.Fragment,null,r.a.createElement(I,null),r.a.createElement("main",null,r.a.createElement(E.d,null,r.a.createElement(E.b,{path:"/about"},r.a.createElement(U,null)),r.a.createElement(E.b,{path:"/registration"},e?r.a.createElement(q,null):r.a.createElement(E.a,{to:"/"})),r.a.createElement(E.b,{path:"/login"},e?r.a.createElement(K,null):r.a.createElement(E.a,{to:"/"})),r.a.createElement(E.b,{path:"/write-story"},e?r.a.createElement(E.a,{to:"/login"}):r.a.createElement(ee,null)),r.a.createElement(E.b,{path:"/stories/",exact:!0},r.a.createElement(le,null)),r.a.createElement(E.b,{path:"/authors/",exact:!0},r.a.createElement(ke,null)),r.a.createElement(E.b,{path:"/stories/:id"},r.a.createElement(Ee,null)),r.a.createElement(E.b,{path:"/authors/:id"},r.a.createElement(be,null)),r.a.createElement(E.b,{path:"/settings"},e?r.a.createElement(E.a,{to:"/login"}):r.a.createElement(Ae,null)),r.a.createElement(E.b,{path:"/"},e?r.a.createElement(E.a,{to:"/about"}):r.a.createElement(le,null)))),r.a.createElement(B,null),r.a.createElement(Ge,null))}}]),n}(r.a.Component),qe=Object(c.b)((function(e){return{needLogin:e.needLogin}}),b)(h()(Object(E.h)(Re))),Pe=function(){return r.a.createElement("div",null,"Error!!!")},Ye=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={hasError:!1},e}return Object(u.a)(n,[{key:"componentDidCatch",value:function(){this.setState((function(){return{hasError:!0}}))}},{key:"render",value:function(){return this.state.hasError?r.a.createElement(Pe,null):this.props.children}}]),n}(a.Component),Ke=n(1),He=n.n(Ke),ze=n(8),Xe=(n(74),n(24)),Ve={needLogin:!0,firstStoryGenresList:[],genresList:[],userData:{username:void 0,urlToImage:null,name:void 0,surname:void 0,userId:void 0,about:void 0,email:void 0},nextRoute:null,errorBanners:[]},We=Object(Xe.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ve,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"login":return Object(P.a)({},e,{needLogin:a});case"setFirstStoryGenresList":var r=e.firstStoryGenresList,s=r.findIndex((function(e){return e===a}));return-1!==s?r.splice(s,1):r.push(a),Object(P.a)({},e,{firstStoryGenresList:r});case"loadGenres":return Object(P.a)({},e,{genresList:a});case"updateUserData":return Object(P.a)({},e,{userData:Object(P.a)({},e.userData,{},a)});case"removeFirstStoryGenresList":return Object(P.a)({},e,{firstStoryGenresList:[]});case"setNextRoute":return Object(P.a)({},e,{nextRoute:a});case"addErrorBanner":var o=e.errorBanners;return Object(P.a)({},e,{errorBanners:[Object(P.a)({},a,{id:Date.now()})].concat(Object(w.a)(o.slice(0,o.length)))});case"removeErrorBanner":var c=e.errorBanners,l=c.findIndex((function(e){return e.id===a}));return-1!==l?Object(P.a)({},e,{errorBanners:[].concat(Object(w.a)(c.slice(0,l)),Object(w.a)(c.slice(l+1,c.length)))}):Object(P.a)({},e);default:return e}})),Ze=new function e(){var t=this;Object(i.a)(this,e),this.BASE_URL="/api",this._setToken=function(e){return localStorage.setItem("token",e)},this._getToken=function(){return localStorage.getItem("token")},this._sendReq=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"post",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";return fetch(t.BASE_URL+e,{method:a,headers:{"Content-Type":r,Authorization:t._getToken()},body:JSON.stringify(n)})},this._post=function(e,n){return fetch(t.BASE_URL+e,{method:"post",headers:{Authorization:t._getToken()},body:n})},this._get=function(e){return fetch(t.BASE_URL+e)},this._checkError=function(e){if(!e.ok)throw e.status},this._parseRes=function(){var e=Object(ze.a)(He.a.mark((function e(n){var a,r=arguments;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=r.length>1&&void 0!==r[1]?r[1]:"json",t._checkError(n),e.t0=a,e.next="json"===e.t0?5:"text"===e.t0?8:11;break;case 5:return e.next=7,n.json();case 7:return e.abrupt("return",e.sent);case 8:return e.next=10,n.text();case 10:return e.abrupt("return",e.sent);case 11:throw new Error("Invalid action type");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.auth=Object(ze.a)(He.a.mark((function e(){var n;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/auth");case 2:if((n=e.sent).ok){e.next=7;break}return e.abrupt("return",{status:n.status});case 7:return e.t0=P.a,e.t1={},e.next=11,t._parseRes(n);case 11:return e.t2=e.sent,e.t3={status:n.status},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 14:case"end":return e.stop()}}),e)}))),this.login=function(){var e=Object(ze.a)(He.a.mark((function e(n,a){var r,s;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/login",{username:n,password:a});case 2:return r=e.sent,e.next=5,t._parseRes(r);case 5:return s=e.sent,t._setToken(s.token),delete s.token,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.logout=Object(ze.a)(He.a.mark((function e(){return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t._setToken("S T O R Y T E L L E R");case 1:case"end":return e.stop()}}),e)}))),this.reg=function(){var e=Object(ze.a)(He.a.mark((function e(n,a,r){var s,o;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/reg",{username:n,email:a,password:r});case 2:return s=e.sent,e.next=5,t._parseRes(s);case 5:return o=e.sent,t._setToken(o.token),delete o.token,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),this.checkUsername=function(){var e=Object(ze.a)(He.a.mark((function e(n){return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.match(/^[A-Za-z0-9_]{4,16}$/)){e.next=11;break}return e.next=3,t._sendReq("/users/".concat(n),{_id:!0});case 3:if(!e.sent.ok){e.next=8;break}return e.abrupt("return","busy");case 8:return e.abrupt("return","empty");case 9:e.next=12;break;case 11:return e.abrupt("return","incorrect");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.checkEmail=function(){var e=Object(ze.a)(He.a.mark((function e(n){return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.match(/^([a-zA-Z0-9_\-.]+)@([a-zA-Z0-9_\-.]+)\.([a-zA-Z]{2,5})$/)){e.next=11;break}return e.next=3,t._sendReq("/users/check-email/".concat(n),{_id:!0});case 3:if(!e.sent.ok){e.next=8;break}return e.abrupt("return","busy");case 8:return e.abrupt("return","empty");case 9:e.next=12;break;case 11:return e.abrupt("return","incorrect");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.genres={getAll:function(){var e=Object(ze.a)(He.a.mark((function e(){var n;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._get("/genres/");case 2:return n=e.sent,e.next=5,t._parseRes(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},this.image={get:function(e){return"".concat(t.BASE_URL,"/images/").concat(e)},post:function(){var e=Object(ze.a)(He.a.mark((function e(n){var a,r;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("filedata",n),e.next=4,t._post("/images/",a);case 4:return r=e.sent,e.next=7,t._parseRes(r,"text");case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},this.getMonth=function(e){switch(e){case 0:return"\u0421\u0456\u0447\u043d\u044f";case 1:return"\u041b\u044e\u0442\u043e\u0433\u043e";case 2:return"\u0411\u0435\u0440\u0435\u0437\u043d\u044f";case 3:return"\u041a\u0432\u0456\u0442\u043d\u044f";case 4:return"\u0422\u0440\u0430\u0432\u043d\u044f";case 5:return"\u0427\u0435\u0440\u0432\u043d\u044f";case 6:return"\u041b\u0438\u043f\u043d\u044f";case 7:return"\u0421\u0435\u0440\u043f\u043d\u044f";case 8:return"\u0412\u0435\u0440\u0435\u0441\u043d\u044f";case 9:return"\u0416\u043e\u0432\u0442\u043d\u044f";case 10:return"\u041b\u0438\u0441\u0442\u043e\u043f\u0430\u0434\u0430";case 11:return"\u0413\u0440\u0443\u0434\u043d\u044f";default:throw new Error("Invalid date")}},this.convertData=function(e){var n=new Date(e);return{day:n.getDate(),month:t.getMonth(n.getMonth()),year:n.getFullYear()}},this.stories={get:function(){var e=Object(ze.a)(He.a.mark((function e(n){var a,r,s;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._get("/stories/"+n);case 2:return a=e.sent,e.next=5,t._parseRes(a);case 5:return r=e.sent,s=r.publishedAt,e.abrupt("return",Object(P.a)({},r,{publishedAt:t.convertData(s)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getSmallData:function(){var e=Object(ze.a)(He.a.mark((function e(n,a){var r,s,o=arguments;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:{},e.next=3,t._sendReq("/stories/find-one",{id:n,selection:a,find:r});case 3:return s=e.sent,e.abrupt("return",t._parseRes(s));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),getAll:function(){var e=Object(ze.a)(He.a.mark((function e(n){var a,r;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/stories/find",n);case 2:return a=e.sent,e.next=5,t._parseRes(a);case 5:return r=e.sent,e.abrupt("return",r.map((function(e){var n=e.publishedAt;return Object(P.a)({},e,{publishedAt:t.convertData(n)})})));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),post:function(){var e=Object(ze.a)(He.a.mark((function e(n,a,r,s,o,c){var l;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/stories/",{title:n,body:a,genres:r,previewImage:s,previewBody:o,previewTitle:c});case 2:return l=e.sent,e.next=5,t._parseRes(l);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n,a,r,s,o){return e.apply(this,arguments)}}(),like:function(){var e=Object(ze.a)(He.a.mark((function e(n){var a;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/stories/like/".concat(n));case 2:return a=e.sent,e.abrupt("return",t._checkError(a));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unlike:function(){var e=Object(ze.a)(He.a.mark((function e(n){var a;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/stories/like/".concat(n),{},"DELETE");case 2:return a=e.sent,e.abrupt("return",t._checkError(a));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),removeStory:function(){var e=Object(ze.a)(He.a.mark((function e(n){var a;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/stories/".concat(n),{},"DELETE");case 2:return a=e.sent,e.abrupt("return",t._checkError(a));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),comment:function(){var e=Object(ze.a)(He.a.mark((function e(n,a){var r;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/stories/comment/",{storyId:n,body:a});case 2:return r=e.sent,e.abrupt("return",t._checkError(r));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),commentLike:function(){var e=Object(ze.a)(He.a.mark((function e(n,a){var r;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/stories/comment/like",{storyId:n,commentId:a});case 2:return r=e.sent,e.next=5,t._checkError(r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),commentUnlike:function(){var e=Object(ze.a)(He.a.mark((function e(n,a){var r;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/stories/comment/like",{storyId:n,commentId:a},"delete");case 2:return r=e.sent,e.next=5,t._checkError(r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),removeComment:function(){var e=Object(ze.a)(He.a.mark((function e(n,a){var r;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/stories/comment/",{storyId:n,commentId:a},"delete");case 2:return r=e.sent,e.next=5,t._checkError(r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},this.drafts={save:function(){var e=Object(ze.a)(He.a.mark((function e(n,a,r,s,o){var c;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/drafts/",{title:n,body:a,previewTitle:r,previewBody:s,previewImage:o});case 2:return c=e.sent,e.next=5,t._checkError(c);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n,a,r,s){return e.apply(this,arguments)}}()},this.users={get:function(){var e=Object(ze.a)(He.a.mark((function e(n,a){var r;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/users/"+n,a);case 2:return r=e.sent,e.abrupt("return",t._parseRes(r));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),getById:function(){var e=Object(ze.a)(He.a.mark((function e(n,a){var r;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/users/getById/"+n,a);case 2:return r=e.sent,e.abrupt("return",t._parseRes(r));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),getSmallData:function(){var e=Object(ze.a)(He.a.mark((function e(n,a){var r;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/users/get",{id:n,selection:a});case 2:return r=e.sent,e.abrupt("return",t._parseRes(r));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),follow:function(){var e=Object(ze.a)(He.a.mark((function e(n){var a;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/users/follow/"+n);case 2:return a=e.sent,e.abrupt("return",t._checkError(a));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unfollow:function(){var e=Object(ze.a)(He.a.mark((function e(n){var a;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/users/follow/"+n,{},"delete");case 2:return a=e.sent,e.abrupt("return",t._checkError(a));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getAll:function(){var e=Object(ze.a)(He.a.mark((function e(n,a,r,s){var o;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/users/find",{selection:r,skip:n,limit:a,find:s});case 2:return o=e.sent,e.next=5,t._parseRes(o);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),update:function(){var e=Object(ze.a)(He.a.mark((function e(n){var a;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/users",n,"PATCH");case 2:return a=e.sent,e.abrupt("return",t._checkError(a));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),updatePassword:function(){var e=Object(ze.a)(He.a.mark((function e(n,a){var r;return He.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._sendReq("/users/updatePassword",{oldPassword:n,newPassword:a},"PATCH");case 2:return r=e.sent,e.abrupt("return",t._checkError(r));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}};o.a.render(r.a.createElement(Ye,null,r.a.createElement(c.a,{store:We},r.a.createElement(f,{value:Ze},r.a.createElement(l.a,null,r.a.createElement(qe,null))))),document.getElementById("root"))}]),[[37,1,2]]]);
//# sourceMappingURL=main.0d71cfad.chunk.js.map